{"version":3,"sources":["posts/captures/fiber_structure.png","posts/captures/fiber_relationship.jpeg","posts/useRestTop.jsx","posts/Tag.jsx","posts/captures/createUpdate.png","posts/captures/Partial_Lanes.png","posts/captures/event_loop.png","posts/captures/forceFrameRate.png","posts/captures/scheduleCallback.png","posts/captures/createLaneMap.png","posts/captures/PACKED and HOLEY.png","posts/captures/promise.png","posts/index.js","posts/Post1.jsx","posts/captures/workInProgress.png","posts/Post2.jsx","posts/captures/LaneType.png","posts/Post3.jsx","posts/Post4.jsx","posts/captures/newArray.png","posts/Post5.jsx","posts/Post6.jsx","assets/images/cd-icon-location.svg","assets/images/cd-icon-movie.svg","assets/images/cd-icon-picture.svg","components/Timeline/PostItem.jsx","components/Timeline/index.jsx","components/Background/Bubbles.jsx","components/Header/Header.jsx","components/Post/index.jsx","App.js","reportWebVitals.js","index.js"],"names":["useResetTop","useEffect","window","scrollTo","Tag","jumpTo","open","props","link","onClick","this","className","children","React","Component","Post1","src","fiberSturcture","fiberRelationship","alt","Post2","imgCreateUpdate","style","display","Lanes","textIndent","Post3","marginLeft","picForceFrameRate","picScheduleCallback","Post4","ImgCreateLaneMap","ImgPACKEDandHOLEY","marginBottom","Post5","ImgPromise","Post6","paddingLeft","picLoop","IconPicture","IconLocation","IconMovie","picClassNameLoop","PostItem","setPost","post","index","animated","useRef","useInView","threshold","ref","inView","entry","current","title","desc","timeLineScrollTop","postInfo","withRouter","useState","PostComponent","postMap","refCallback","useCallback","sessionStorage","getItem","setItem","setTimeout","classList","add","useLayoutEffect","scrollY","SwitchTransition","CSSTransition","classNames","timeout","id","map","toString","height","Circle","color","radius","fixedX","fixedY","scale","isWiggling","x","y","origin","ctx","canvas","width","pos","Bubbles","resizeHandler","resizeCanvas","step","circles","instantiateCanvas","instantiateCircles","size","fx","fy","addEventListener","TweenLite","ticker","draw","removeEventListener","document","getElementById","getContext","globalCompositeOperation","data","i","length","newCircle","setOriginalPosition","push","wiggleCircle","circle","tweenProperties","name","min","max","wiggleProperties","obj","properties","duration","Math","random","tweenOptions","ease","Power1","easeInOut","onComplete","property","to","canvasEl","clearRect","clientWidth","clientHeight","drawCircle","rad","calculateRadius","calculateRelativePosition","beginPath","arc","PI","fillStyle","fill","containerEl","Header","showAbout","setShowAbout","close","setClose","localStorage","disableScroll","e","preventDefault","toggleAbout","target","contains","body","passive","fontWeight","Post","href","App","exact","path","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"2UAAe,MAA0B,4CCA1B,MAA0B,gDCC1B,SAASA,IACtBC,qBAAU,WACRC,OAAOC,SAAS,EAAG,KAClB,I,+CCDgBC,G,kNACnBC,OAAS,WACPH,OAAOI,KAAK,EAAKC,MAAMC,O,4CAEzB,WACE,OAAO,sBAAMC,QAASC,KAAKL,OAAQM,UAAU,MAAtC,SAA6CD,KAAKH,MAAMK,e,GALlCC,IAAMC,YCHxB,MAA0B,yCCA1B,MAA0B,0CCA1B,ICAA,MAA0B,2CCA1B,MAA0B,6CCA1B,UAA0B,0CCA1B,MAA0B,6CCA1B,UAA0B,oCCM1B,OACbC,MCFa,WAEb,OADAf,IAEE,qCACE,6CACA,uFAAY,yCAAZ,8LAAmE,4DAAnE,+DACA,sIAAuC,oDAAvC,iFAAiF,oFAAjF,YACA,6LACA,6IAAqB,kEAArB,m2BACA,+MAA0C,oDAA1C,wEACA,6zBACA,iuBACA,uBACA,8MACA,4FACA,qBAAKgB,IAAKC,IACV,wGAAmB,0DAAnB,2RACA,q0BAAyN,8CAAzN,gDACA,mpDACA,0TACA,qBAAKD,IAAKE,EAAmBC,IAAI,KACjC,ooEACA,yiBAAkG,kDAAlG,+DACA,qBAAKH,IC5BI,ijLD4BiBG,IAAI,KAC9B,spBDrBJC,MGFa,WAEb,OADApB,IACO,qCACL,kDACA,yLAAuD,cAAC,EAAD,CAAKQ,KAAK,+CAAV,6CACvD,+SACA,8FAAmB,cAAC,EAAD,CAAKA,KAAK,+CAAV,4BAAnB,8YACA,qBAAKQ,IAAKK,EAAiBF,IAAI,KAC/B,gbAAuF,cAAC,EAAD,CAAKX,KAAK,iJAAV,sCAAvF,YACA,qqBACA,iuBACA,myBACA,4qCACA,0SACA,qBAAKQ,ICpBM,6wGDoBSG,IAAI,KACxB,wPAAgD,sBAAMG,MAAO,CAAEC,QAAS,QAAxB,SAAkC,cAAC,EAAD,CAAKf,KAAK,8IAAV,+BAClF,qBAAKQ,IAAKQ,EAAOL,IAAI,KACrB,ksBACA,2zBACA,iGAAiB,uBAAM,uBAAMG,MAAO,CAAEG,WAAY,MAAOF,QAAS,gBAA3C,2QAA8G,qCAA9G,uJAAwJ,mEAC/K,yHAAqB,uBAAM,uBAAMD,MAAO,CAAEG,WAAY,MAAOF,QAAS,gBAA3C,oZAA+H,qCAA/H,wCAAoJ,iEAC/K,yKAA6B,uBAAM,uBAAMD,MAAO,CAAEG,WAAY,MAAOF,QAAS,gBAA3C,iWAAmI,qCAAnI,8CAAyJ,gDAAzJ,wLACnC,mMACA,uhCAA2Q,sBAAMD,MAAO,CAAEC,QAAS,QAAxB,iJAA6E,sBAAMD,MAAO,CAAEC,QAAS,QAAxB,sgCHpB1VG,MKHa,WAEb,OADA1B,IAEE,qCACE,kDACA,kGAAkB,cAAC,EAAD,CAAKQ,KAAK,0CAAV,uBAAlB,kLACA,q3BACA,oqCACA,wHACA,qBAAKQ,IXfI,6gNWeeM,MAAO,CAAEK,WAAY,SAC7C,6MACA,8vBAAkJ,sBAAML,MAAO,CAAEC,QAAS,QAAxB,4FAAlJ,iTAA2Q,iDAA3Q,6hBAA2Z,8CAA3Z,yTACA,k8BAA2L,cAAC,EAAD,CAAKf,KAAK,sIAAV,4BAA3L,6FAA8W,iDAA9W,kBACA,qBAAKQ,IAAKY,EAAmBT,IAAI,KACjC,4sBAAiK,4CAAjK,YACA,uBACA,uNACA,oIAA2B,8CAA3B,SAAmD,6CAAnD,yDAAkF,+DAAlF,kNAAqJ,kDAArJ,uLAA8M,8EAA9M,2BAAsO,0FAAtO,8KACA,yLAA4D,yCAA5D,05BACA,oIACA,qBAAKH,IAAKa,EAAqBV,IAAI,KACnC,uFAAY,cAAC,EAAD,CAAKX,KAAK,4HAAV,2BLjBhBsB,MMJa,WAEb,OADA9B,IAEE,qCACE,oFACA,sIAAwB,iDAAxB,gGACA,qBAAKgB,IAAKe,EAAkBT,MAAO,CAAEK,WAAY,SACjD,uLAA4B,8CAA5B,iFAAgE,2CAAhE,oCACA,qKACA,qBAAKX,ICfI,qzHDecM,MAAO,CAAEK,WAAY,SAC5C,2KAA0B,cAAC,EAAD,CAAKnB,KAAK,0DAAV,qEAA1B,sJACA,uHAAmB,kDAAnB,qfAAsI,4CAAtI,0LACA,uHAAkC,uDAAlC,OAAsE,0DAAtE,OAA6G,sDAC7G,uKAAqC,uDAArC,oPAA6H,0DAA7H,oPAAkO,mDAAlO,mGAAuS,oFAAvS,4sBAAsmB,sDAAtmB,SAAunB,sDAAvnB,uTACA,uHAA6B,0CAA7B,6IAAuE,yCAAvE,mIAAqH,0CAArH,yEAA4J,yCAA5J,mIAAqM,0EAArM,4dAAwa,yCAAxa,mUAA+gB,mDAA/gB,mDAAmjB,kDAAnjB,wHACA,4VAAyE,gGAAzE,sbAA2P,gGAA3P,8QACA,ydAAwF,sGAAxF,0OACA,4DAAU,qDAAV,6YACA,qBAAKQ,IAAKgB,EAAmBV,MAAO,CAAEK,WAAY,MAAOM,aAAc,aNb3EC,MQPa,WAEb,OADAlC,IAEE,qCACE,yDACA,4BAAG,cAAC,EAAD,CAAKQ,KAAK,sEAAV,yGACH,qBAAKQ,IAAKmB,EAAYb,MAAO,CAAEK,WAAY,MAAOM,aAAc,eREpEG,MSTa,WAEb,OADApC,IAEE,qCACE,+BAAI,4DAAJ,SAA0C,gDAA1C,SAAoE,0DACpE,yMAA+B,uBAAM,sBAAMsB,MAAO,CAAEe,YAAa,OAA5B,oBAArC,IAAmF,cAAC,EAAD,CAAK7B,KAAK,gIAAV,sCAAwK,uBAAM,sBAAMc,MAAO,CAAEe,YAAa,OAA5B,oBAAjQ,IAA+S,cAAC,EAAD,CAAK7B,KAAK,qHAAV,0BAAiJ,uBAAM,sBAAMc,MAAO,CAAEe,YAAa,OAA5B,oBAAtc,IAAof,cAAC,EAAD,CAAK7B,KAAK,qFAAV,oCACpf,8BAAG,4DAAH,61BACA,8BAAG,gDAAH,iLAA8D,2CAA9D,mlBACA,8BAAG,uDAAH,u5B,gBCXS,MAA0B,6CCA1B,MAA0B,0CCA1B,MAA0B,4C,QCOnC8B,EAAU,CAACC,EAAaC,EAAcC,GACtCC,EAAmB,CAAC,aAAc,WAAY,eAErC,SAASC,EAASpC,GAC/B,IAAQqC,EAAyBrC,EAAzBqC,QAASC,EAAgBtC,EAAhBsC,KAAMC,EAAUvC,EAAVuC,MACjBC,EAAWC,kBAAO,GACxB,EAA+BC,YAAU,CACvCC,UAAW,MADLC,EAAR,EAAQA,IAAKC,EAAb,EAAaA,OAAb,EAAqBC,MAQrB,OALApD,qBAAU,WACM,GAAVmD,GAAsC,GAApBL,EAASO,UAC7BP,EAASO,SAAU,KAEpB,CAACF,IAEF,sBAAKzC,UAAU,oBAAoBwC,IAAKA,EAAK,cAAaC,EAA1D,UACE,qBAAKzC,UAAS,0BAAqB+B,EAAiBI,EAAQ,GAA9C,YAAoDC,EAASO,QAAU,GAAKF,EAAS,YAAc,aAAjH,SACE,qBAAKpC,IAAKsB,EAAQQ,EAAQ,GAAI3B,IAAI,cAGpC,sBAAKR,UAAS,8BAAyBoC,EAASO,QAAU,GAAKF,EAAS,YAAc,aAAe3C,QAAS,kBAAMmC,EAAQ,OAAD,OAAQE,EAAQ,KAA3I,UACE,6BAAKD,EAAKU,QACV,4BACGV,EAAKW,OAER,sBAAM7C,UAAU,eAAhB,4CCtBR,IAAI8C,EAAoB,EAElBC,EAAW,CACf,CACEH,MAAO,cACPC,KAAM,wJAER,CACED,MAAO,mBACPC,KAAM,qTAER,CACED,MAAO,mBACPC,KAAM,oNAER,CACED,MAAO,kBACPC,KAAM,mMAER,CACED,MAAO,sBACPC,KAAM,yGAER,CACED,MAAO,uCACPC,KAAM,6KAoDKG,mBAhDf,SAAkBpD,GAChB,MAAwBqD,mBAAS,MAAjC,mBAAOf,EAAP,KAAaD,EAAb,KACMiB,EAAgBC,EAAQjB,GACxBkB,EAAcC,uBAAY,SAACb,GAC3BA,IACec,eAAeC,QAAQ,cAEtCD,eAAeE,QAAQ,YAAY,GACnCC,YAAW,WACTjB,EAAIkB,UAAUC,IAAI,UACjB,SAGN,IAQH,OAPAC,2BAAgB,WACV1B,EACFY,EAAoBvD,OAAOsE,QAE3BtE,OAAOC,SAAS,EAAGsD,KAEpB,CAACZ,IAEF,cAAC4B,EAAA,EAAD,UACE,cAACC,EAAA,EAAD,CAAeC,WAAW,QAAQC,QAAS,IAA3C,SACY,OAAT/B,EAAgB,yBAASgC,GAAG,cAAclE,UAAU,eAApC,SACd+C,EAASoB,KAAI,SAACjC,EAAMC,GAAP,OACZ,cAACH,EAAD,CAAUE,KAAMA,EAAMC,MAAOA,EAAOF,QAASA,GAAcE,EAAMiC,iBAGjE,gCACA,sBAAKF,GAAG,iBAAR,UACE,sBAAKlE,UAAU,gBAAf,UAEE,sBAAMA,UAAU,iBAAiBwC,IAAKY,EAAaR,MAAM,eAAK9C,QAAS,kBAAMmC,EAAQ,SACrF,sBAAMjC,UAAU,mBAChB,sBAAMA,UAAU,sBAElB,qBAAKA,UAAU,eAAf,SACE,cAACkD,EAAD,SAGJ,qBAAKvC,MAAO,CAAE0D,OAAQ,eAlByBnC,QC3DrDoC,G,iBAEJ,WAAYC,EAAOC,GAAS,oBAC1BzE,KAAKwE,MAAQA,EACbxE,KAAKyE,OAASA,EACdzE,KAAK0E,OAAS,OACd1E,KAAK2E,OAAS,MACd3E,KAAK4E,MAAQ,EACb5E,KAAK6E,YAAa,E,uDAGpB,SAAoBC,EAAGC,GAIrB/E,KAAKgF,OAAS,CAAEF,IAAGC,KACnB/E,KAAK8E,EAAIA,EACT9E,KAAK+E,EAAIA,I,uCAGX,SAA0BE,GAGxB,IAAMX,EAASW,EAAIC,OAAOZ,OACpBa,EAAQF,EAAIC,OAAOC,MACnBC,EAAM,CACVN,EAAG9E,KAAK8E,EACRC,EAAG/E,KAAK+E,GAWV,MARoB,UAAhB/E,KAAK0E,SACPU,EAAIN,GAAKK,GAGS,WAAhBnF,KAAK2E,SACPS,EAAIL,GAAKT,GAGJc,I,6BAGT,WACE,OAAOpF,KAAKyE,OAASzE,KAAK4E,U,MAITS,E,4MAEnBC,cAAgB,WACd,EAAKC,aAAa,EAAKN,KACvB,EAAKO,KAAK,EAAKC,QAAS,EAAKR,M,uDAG/B,WAAqB,IAAD,OAsBZA,EAAMjF,KAAKiF,IAAMjF,KAAK0F,oBACxBD,EAAUzF,KAAKyF,QAAU,GAE7BA,EAAUzF,KAAK2F,mBAxBK,CAClB,CAAEC,KAAM,GAAIC,GAAI,OAAQf,EAAG,IAAKgB,GAAI,MAAOf,EAAG,IAAKP,MAAO,0BAC1D,CAAEoB,KAAM,GAAIC,GAAI,OAAQf,EAAG,IAAKgB,GAAI,MAAOf,EAAG,IAAKP,MAAO,0BAE1D,CAAEoB,KAAM,GAAIC,GAAI,OAAQf,EAAG,IAAKgB,GAAI,MAAOf,EAAG,IAAKP,MAAO,2BAE1D,CAAEoB,KAAM,GAAIC,GAAI,OAAQf,EAAG,IAAKgB,GAAI,MAAOf,EAAG,IAAKP,MAAO,0BAG1D,CAAEoB,KAAM,IAAKC,GAAI,OAAQf,EAAG,IAAKgB,GAAI,SAAUf,GAAI,IAAKP,MAAO,0BAE/D,CAAEoB,KAAM,IAAKC,GAAI,OAAQf,EAAG,IAAKgB,GAAI,SAAUf,GAAI,IAAKP,MAAO,0BAE/D,CAAEoB,KAAM,GAAIC,GAAI,OAAQf,EAAG,IAAKgB,GAAI,SAAUf,GAAI,IAAKP,MAAO,0BAC9D,CAAEoB,KAAM,GAAIC,GAAI,QAASf,GAAI,IAAKgB,GAAI,MAAOf,EAAG,IAAKP,MAAO,yBAC5D,CAAEoB,KAAM,GAAIC,GAAI,QAASf,GAAI,IAAKgB,GAAI,MAAOf,EAAG,IAAKP,MAAO,2BAC5D,CAAEoB,KAAM,GAAIC,GAAI,QAASf,GAAI,IAAKgB,GAAI,MAAOf,EAAG,IAAKP,MAAO,yBAC5D,CAAEoB,KAAM,IAAKC,GAAI,QAASf,GAAI,IAAKgB,GAAI,SAAUf,GAAI,IAAKP,MAAO,yBACjE,CAAEoB,KAAM,GAAIC,GAAI,QAASf,GAAI,IAAKgB,GAAI,SAAUf,GAAI,IAAKP,MAAO,0BAChE,CAAEoB,KAAM,IAAKC,GAAI,QAASf,GAAI,GAAIgB,GAAI,SAAUf,GAAI,GAAIP,MAAO,6BAMjExE,KAAKuF,aAAaN,GAClBjF,KAAKwF,KAAKC,EAASR,GAEnBzF,OAAOuG,iBAAiB,SAAU/F,KAAKsF,eACvC9F,OAAOwG,UAAUC,OAAOF,iBAAiB,QAAQ,WAAQ,EAAKG,KAAKT,EAASR,Q,kCAG9E,WACEzF,OAAO2G,oBAAoB,SAAUnG,KAAKsF,iB,+BAG5C,WACE,IAAML,EAAMmB,SAASC,eAAe,UAAUC,WAAW,MAEzD,OADArB,EAAIsB,yBAA2B,mBACxBtB,I,gCAGT,SAAmBuB,GAIjB,IAHA,IAAMf,EAAU,GAGPgB,EAAI,EAAGA,EAAID,EAAKE,OAAQD,IAAK,CACpC,IAAME,EAAY,IAAIpC,EACtBoC,EAAUnC,MAAQgC,EAAKC,GAAGjC,MAC1BmC,EAAUlC,OAAS+B,EAAKC,GAAGb,KAC3Be,EAAUjC,OAAS8B,EAAKC,GAAGZ,GAC3Bc,EAAUhC,OAAS6B,EAAKC,GAAGX,GAC3Ba,EAAU/B,MAAQ,EAClB+B,EAAUC,oBAAoBJ,EAAKC,GAAG3B,EAAG0B,EAAKC,GAAG1B,GAEjDU,EAAQoB,KAAKF,GAGf,OAAOlB,I,kBAGT,SAAKA,EAASR,GAEZ,IAAK,IAAMwB,KAAKhB,EACdzF,KAAK8G,aAAarB,EAAQgB,GAAIxB,K,0BAIlC,SAAa8B,GACX,GAAIA,EAAOlC,WAAY,CAErB,IAAMmC,EAAkB,CACtB,CACEC,KAAM,QACNC,IAAK,IACLC,IAAK,GACJ,CACDF,KAAM,IACNC,IAAKH,EAAOjC,EAAI,IAChBqC,IAAKJ,EAAOjC,EAAI,KACf,CACDmC,KAAM,IACNC,IAAKH,EAAOhC,EAAI,IAChBoC,IAAKJ,EAAOhC,EAAI,MAGpB/E,KAAKoH,iBAAiBL,EAAQC,M,8BAIlC,SAAiBK,EAAKC,GAAa,IAAD,OAC1BC,EAA2B,GAAhBC,KAAKC,SAAgB,IAChCC,EAAe,CACnBC,KAAMnI,OAAOoI,OAAOC,UACpBC,WAAY,WAAQ,EAAKV,iBAAiBC,EAAKC,KAGjD,IAAK,IAAMb,KAAKa,EAAY,CAC1B,IAAMS,EAAWT,EAAWb,GAC5BiB,EAAaK,EAASd,MAAQO,KAAKC,UAAYM,EAASZ,IAAMY,EAASb,KAAOa,EAASb,IAGzF1H,OAAOwG,UAAUgC,GAAGX,EAAKE,EAAUG,K,kBAGrC,SAAKjC,EAASR,GACZ,IAAMgD,EAAWhD,EAAIC,OAMrB,IAAK,IAAMuB,KAHXxB,EAAIiD,UAAU,EAAG,EAAGD,EAASE,YAAaF,EAASG,cAGnC3C,EACdzF,KAAKqI,WAAW5C,EAAQgB,GAAIxB,K,wBAIhC,SAAW8B,EAAQ9B,GACjB,IAAMqD,EAAMvB,EAAOwB,kBACbnD,EAAM2B,EAAOyB,0BAA0BvD,GAE7CA,EAAIwD,YACJxD,EAAIyD,IAAItD,EAAIN,EAAGM,EAAIL,EAAGuD,EAAK,EAAG,EAAId,KAAKmB,IAAI,GAC3C1D,EAAI2D,UAAY7B,EAAOvC,MACvBS,EAAI4D,S,0BAGN,SAAa5D,GACX,IAAM6D,EAAc1C,SAASC,eAAe,qBAE5CpB,EAAIC,OAAOZ,OAASwE,EAAYV,aAChCnD,EAAIC,OAAOC,MAAQ2D,EAAYX,c,oBAEjC,WACE,OACE,qBAAKhE,GAAG,oBAAR,SACE,wBAAQA,GAAG,SAASlE,UAAU,iB,GAhJDE,IAAMC,W,MC7C5B,SAAS2I,EAAOlJ,GAC7B,MAAkCqD,oBAAS,GAA3C,mBAAO8F,EAAP,KAAkBC,EAAlB,KACA,EAA0B/F,oBAAS,GAAnC,mBAAOgG,EAAP,KAAcC,EAAd,KACA5J,qBAAU,WACO6J,aAAa5F,QAAQ,iBAElC4F,aAAa3F,QAAQ,eAAe,GACpCwF,GAAa,MAEd,IACH,IAAMI,EAAgB/F,uBAAY,SAAAgG,GAAC,OAAIA,EAAEC,mBAAkB,IACrDC,EAAc,SAACF,GACfN,EACEM,EAAEG,OAAO9F,UAAU+F,SAAS,sBAC9BP,GAAS,GACTzF,YAAW,WACT0C,SAASuD,KAAKxD,oBAAoB,QAASkD,GAC3CJ,GAAcD,GACdG,GAAS,KACR,OAGLF,GAAcD,GACd5C,SAASuD,KAAK5D,iBAAiB,QAASsD,EAAe,CAAEO,SAAS,MAGtE,OACE,sBAAK3J,UAAU,SAAf,UACE,qBAAKA,UAAU,QAAQF,QAASyJ,EAAhC,0BACA,qBAAKvJ,UAAS,2BAAsB+I,EAAY,OAAS,GAA3C,YAAiDE,EAAQ,QAAU,IAAMnJ,QAASyJ,EAAhG,SACE,sBAAKvJ,UAAS,gBAAWiJ,EAAQ,QAAU,IAA3C,UACE,0DACA,kPACA,sLAAgC,sBAAMjJ,UAAU,MAAhB,gCAAhC,WAAmE,sDAAnE,YACA,8BAAG,sBAAMA,UAAU,MAAhB,gCAAH,iLAAqE,cAAC,EAAD,CAAKH,KAAK,4HAAV,uBAArE,SAA2N,sDAA3N,sKAAuQ,kDAAvQ,4JACA,iLAA2B,sBAAMc,MAAO,CAAE4D,MAAO,QAASqF,WAAY,QAA3C,sCAG/B,4IACA,sBAAK5J,UAAU,OAAf,UACE,sBAAMA,UAAU,WAAgB,uBADlC,KAEI,sD,YCPW6J,G,kKACnB,WACE,OAAO,sBAAK7J,UAAU,cAAf,UACL,0DACA,sBAAKA,UAAU,YAAf,UACE,sBAAMA,UAAU,gBAAqB,uBADvC,MAEK,mBAAG8J,KAAK,4BAA4BN,OAAO,KAA3C,yBAFL,6B,GAJ4BtJ,IAAMC,YCRzB4J,MAnBf,WACE,OAEE,aADA,CACC,IAAD,UACE,eAAC,IAAD,WACE,eAAC,IAAD,CAAOC,OAAK,EAACC,KAAK,IAAlB,UACE,cAAC,EAAD,IACA,cAACnB,EAAD,IACA,cAAC,EAAD,OAEF,cAAC,IAAD,CAAOkB,OAAK,EAACC,KAAK,QAAlB,SACE,cAAC,EAAD,YCVKC,EAZS,SAAAC,GAClBA,GAAeA,aAAuBC,UACxC,6BAAqBC,MAAK,YAAkD,IAA/CC,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAQP,OCDdQ,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEF1E,SAASC,eAAe,SAM1B8D,M","file":"static/js/main.191e0fd6.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/fiber_structure.2aa908cc.png\";","export default __webpack_public_path__ + \"static/media/fiber_relationship.d6d3cf53.jpeg\";","import { useEffect } from 'react';\r\nexport default function useResetTop() {\r\n  useEffect(() => {\r\n    window.scrollTo(0, 0);\r\n  }, [])\r\n}","import React from 'react';\r\nimport './tag.css';\r\n\r\nexport default class Tag extends React.Component {\r\n  jumpTo = () => {\r\n    window.open(this.props.link);\r\n  }\r\n  render() {\r\n    return <span onClick={this.jumpTo} className=\"tag\">{this.props.children}</span>\r\n  }\r\n}","export default __webpack_public_path__ + \"static/media/createUpdate.8191335a.png\";","export default __webpack_public_path__ + \"static/media/Partial_Lanes.6e03d3d0.png\";","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnUAAABpCAYAAABcfNWdAAAAAXNSR0IArs4c6QAAEy9JREFUeF7t3U2MXWUdx/HfMMMMlJdAmQYXaLwmEKyBlmgnJjqRDMYuTMRpXNpuJkWWaAkbY9rGuDEOsiQ2s2ldmhlLwqJGGkw1ISXGqQ1I2oRJpC6IAzTSFmaYYcx5vc95zus9Z9rz3Hu/rqT3POc8z+c5vffX/3Oee0euXbu2pYL/ff0bjxe9zGsIIIAAAggggAACDgiMEOocmAW6gAACCCCAAAIINBQg1DUEpDkCCCCAAAIIIOCCAKHOhVmgDwgggAACCCCAQEMBQl1DQJojgAACCCCAAAIuCBDqXJgF+oAAAggggAACCDQUINQ1BKQ5AggggAACCCDgggChzoVZoA8IIIAAAggggEBDAUJdQ0CaI4AAAggggAACLggQ6lyYBfqAAAIIIIAAAgg0FCDUNQSkOQIIIIAAAggg4IIAoc6FWaAPCCCAAAIIIIBAQwFCXUNAmiOAAAIIIIAAAi4IEOpcmAX6gAACCCCAAAIINBQg1DUEpDkCCCCAAAIIIOCCAKHOhVmgDwgggAACCCCAQEMBQl1DQJojgAACCCCAAAIuCBDqXJgF+oAAAggggAACCDQUINQ1BKQ5AggggAACCCDgggChzoVZoA8IIIAAAggggEBDAUJdQ0CaI4AAAggggAACLggQ6lyYBfqAAAIIIIAAAgg0FCDUNQSkOQIIIIAAAggg4IIAoc6FWaAPCCCAAAIIIIBAQwFCXUNAmiOAAAIIIIAAAi4IEOpcmAX6gAACCCCAAAIINBRwNNT9Ql87/ZQ+/u2T+vfr+SPc8fPXtW/qHq2+8nW9tdA9Lvpz/09W/qi/PPfLhkx5zY9qafm7Wv3NtA7//iZdoo9O2/n1nTq0d1RXzlzTwnwfdbzfu3p8URdmVjU//YxOhmM5dOKcDuuEpg9Hf5Ic5LGlZe35517NHm0weO+6T39F0rta2ntAxxqciqYIIIAAAs0FBjLURSx+uNv12k0KdYd04tzP9Og7L+Z+cDafnv46Q2GoOzKuo9/e0snZz7RiDStqZ/7xteXrmn9hqxnAgdt15NkJyTjX9MLdmvnius5+b13nmp3djdY//p3OPf9VvZP6h4X3D45Z6XROcMttV3VYJeevehqOQwABBBDYNoG+DnVlCjcz1HmVkCOP/itRHSnrz1C/XhbqHljT8bnPt5fIv+aorn24pnn/3LdpbmlC9921qfMDEepK/mHhB7dJvZZXRcuo8FWegLJzVz4RByKAAAIIbJdAK6Fu8qW/q/Pfl/Tmr04Z4zioL516Tve87i2lhsuvr7yjB3+wTzu8o/73pt48+Kxu+C2813+oSf//f6yVnGXa/FBntpdunLf7UsZbtOw6ogNLd+mxu7rniKtOqWBzm+b+NKGPXv5Ei4vB8cmqlVlRCs57/1+7S5v+sYkw5J1vhx4KL1212uVVr6Y+sCtj9vWS59Z7N4wQZr62qYvGeBRWy+5OkXbHlh5H8mC7kpdY3o1MT0kHnp2Qf52ob95ru7d0ceeI/ju7rnNHxjWnDWm/aV5i5p1j/3jcoaSpPdd2BbDIzJ7r8BKGa/69EB5bIZR5y6xPreZVk4NQOHm2xjIsoa7sTYLXEUAAgVsu0Eqoyw5bdqjzQtuK3nr6R1oNQ5ysZ+eCcJf/7F3RdR58JwpyQcBLn7tgLgo+TP3lPXUDTyIwlYU6P0AoXhr0P9Qf3giXLMtCXfB653IUzoJAoQrPt2WHquT1phfGpbloyTLv3OmQGivWrdRZJvL/e7QbHOPQFQYqP0SOacULlh0v1G3o5AcTmnn/E13a7Y1hQ4/EQbrMrGA8UQAvqDAWmpn9XJT8+2bnWnd5uvBeCFSLA1u14OdXnCf/rD2zx3t78yHU9ebF0QgggMAtEGgl1GnuD/rOYxf8Z926VbsvGwEtHdayq3s1Qt2TL2vfnPRWXPWTel2mzf0g9D+oRxJLe72EOu/YR942NxmYoaIk1HnXPigtGs+slVXAEoFr94Zfeev2dyRVRTTvx+zqXoNQt3c0cbsH1Tg7dAWHpEzNkKeu09kHw0rmq6M68v0RXdWGFubUHZfKzILwel/O831BJW2z8vN5Zr+TgV0Kwmo30BffC55CxSpbWfiqUO3LfB+q2+4WvKlxCQQQQGBYBdoJdXGw+o86L+2RdEFvPSd97fQevR9X5pIVuG0LdV6g/EEnPd897JL1KiSzWkpXNxqFuvSybdDJaDmzJNRZy4TxABPLpDm3eRwINzWzMCbF4WdMl6JnzzLOn17ebRDqMite6TFnhrqiDRj+ebeMpWvvnHdIp8JKnrG0mmmWWD5Ob7AINl4ELVMeRWZWxTFZ4S27F7yrVd2oULJDuyz02beMf/yU7l3JuP+H9V2UcSOAAAKOCLQT6vxl0z16/xWp84XTWtn1tPTHVXXiCtpNrNR5oe7JVeP5vN5n4uZU6rIDTLd3FUJdTrgpH6EXxsZ06Yw09eBnOv/A7dKrW5qKKn9hsLlqLOVue6WuINR1l5S9kVjVu5Jl3QP61NpFazgqf0dulllxZc6q6pWZpZ41LH5+Mt0fKnXl9zVHIIAAAsMl0Gqo+/i8pL/9SKvfel2dXauaVLAkm/Ws3LZV6sLn83b0vDnCuDFyl56Sz5pFD7onNkrES2xRNaa7saA4NGSEGa/KFFfiipcKo977VcaO9G7iqy6CUPfRsqQ31vWPb96pmQc29ZCCJdlgs0P4nJq3oSOsQPVUqbPPYXAWLROnTLKesSuo1BWGuvlqZnFX7Wsn3ius+Skxyw7F3RNWWdrlmbrherNmtAgggECZQEuhLtgU0VG4o9Vbjv3pPikOWiWVuswl1GgXbHjue62hJ5ZXk7tfvSPtLzAuhitY+jKX3N67obPakdhZai7XXTlzw9qJmbEj8rrx8LxZ3bm+prOXxzRTsPvVG4P9RcDZoS4MmAqvlfv9bqHK9TVd/HBCnWjHbObSr7ULtmBnb9mzf8ldoNZ5Cyp1tXb1mmapcZnXzlgitZa6zbmWbZa5Kzi5vJv6/j7zXvCmwv/yXxV+8S+7X8veAnkdAQQQGByBlkJd/wNW/Z66sopM/0swgjoCWfeFvXO6/Lx8T125EUcggAACwyNAqKs919V+UYJQVxt4gBtm7ertcSk40mn1FyX4ibwBvkkZGgII9KEAoa7RpJX/9iuhrhHw4DbOWH6t+mXRKRR++3Vw7xNGhgACCPQgQKjrAYtDEUAAAQQQQAABVwUIda7ODP1CAAEEEEAAAQR6ECDU9YDFoQgggAACCCCAgKsChDpXZ4Z+IYAAAggggAACPQgQ6nrA4lAEEEAAAQQQQMBVAUKdqzNDvxBAAAEEEEAAgR4ECHU9YHEoAggggAACCCDgqgChztWZoV8IIIAAAggggEAPAoS6HrA4FIF2BDK+5Nr7JYmfSCemn9HJdjrFVRFAAAEEHBMg1Dk2If3YneCH69M/dn//X69pYX4bRuT/+sKIzn9vXecSpwt+busxrenk7Gda8V47Mq6j+8d15cw2XXsbut/sFPk/R3dsaVmzWtKe2ePNLkFrBBBAAIGBECDUDcQ0tjsI/6fQdm5Klz/V/AtbkoKwdfNDnfd7qRO67/qmzs8GgW964U5N7RzV1e0KlO3S6tCJczry6L80n1mRCwLf5Nm9mj3acke5PAIIIIBA6wL9G+rCikxXcF1n/UpOOlB0fn2nDj2wpuNzn4eHBz+e/lD4X4nf3PTO++2tbuVHQXD46OVPtLgYNPDPt3c0bB1dt8JceufevaGTH0zE7TOvfUo68OyE7vZO+d6N3H7rulGhCi+f7JuSFauEmVlZ8xqHVa+7onHY40qamdcOft92TVf3juhS0RxkmYW/garl62Eg9IKZV/nzrr+hR4x56gpHfff6NKaPlkd1//ufaGH+Ns0tSJe0Q1MfROezxpXw9M6YP670XFuetpk9Hxm/7yoZroXz4V29/LeFlfG7rxXuRA5BAAEEEBhAgf4Mdf6H5ZhWoqCVWJ4rC3XB653L0Yd+8KGuaLmuLNT5H8QKA2QY8B7eMEJgwV0SfYhHwcIeR/whH37wJ163+x2GlQ+7oS8IdJtx3xI9ybyWNY5E8E2OIwhu3eBlvhq9tqg7NOOHK2sOysz810d10ZvPTtLXv07u8msQ6i69vKWp729q/u0xzWldl3Z3++oHREVGtmEQIPPGlX/dKNyP64k31sOwnz0/8X1mjtH7x0HJfPhXqBTYKgS/AXzjYkgIIIAAAmmBvgx1qQ/iXkKdd+xBaTF6BiuqvEWBpiTUedd+5G3zea10JS/3RkudOyv8hOHGrwoar6ss7Fjh1OqEF/gOKFoetc49H1UfcwKhv6x5t2Z2piuD3pni+XhjLLTd0BPG8msVs6CauqGLOyfSy7Z5oS7+88+0a+l23f+hdGluXYqD2kgQ+sxn8aw5KBpXELwmdLXi83mJirAd2sKKYPSPh7L58Fz9pdfJP5c8M8cSLG/sCCCAAAKBwPCFutSybXgrRNWzwlBnL1FGt5G9lJlze+WEukQ1J7H0a5wn1daqYKVCRLrSNvPFdL/MDQXBsmdwTGJZOLhVgk0J4fKs3S6qdnnPtO169VPpYPRMXVWzdOUx7m1pqFvXFWOJPQ5MXsiMlrHNoSeWSfPH5Tcx75cqy6vx8m4Qsu+LlpWtaqVpbXbNdK26EcI77qnVFzV9mH2wvLEjgAACwywwnKEuLzhFH+K5z9Q13ABQpVJXFOqMZd9u4IiWUIsrhoXLjKm/AVYgsV+3KliJc/vPDW4ZFbdqZsE5bmjl4R3G0nh44aJQZ1VdvRZxxezV0Zxdszl/5Usqc8mqXtoo+exmOszmBeG8NyAqdcP81szYEUAAgd4F+jLU+R+e8XNs0YPuyY0SyWeZxo0NByWBJVFRiT6Yu5W4wufWIn/vO8Sen9K9H59P7lq0Ql3qXFnVuHhO7X5nPx+Wt0QaVJzMpd2imyV97uTRyaXeZGD02t6hjro7UEvNTPPMimPO0nLGUnoi1M1tBdVF47nD4r8i5UvY9n0XP4sZbYrIrfhaV64yHzxT1/s7Gi0QQACBIRboy1CXXArc1MUzG+rsN77HzNx1eH1NZy+PaaZg96s3/3nLkFfO3JD2F+1+lVK7UItC3f5x43azdpgWhjqvmbVTM7WTM9o52r1E4vvaSnYMR0urfuuiXbfW8qxdBYx24JrXtnflxmYZ3yuX/t47axlUYcj2NlVkVDbLKmbdpWXL0xpXqs/mztWMXdAXl0f1WHyfZS87V5uPaP68TRCz0umCryypFPyG+B2OoSOAAAJDJNCnoc6aodzdkY7NZGloc6y/dKe+QNZcW8/VVTk531NXRYljEEAAAQQ8AULdrbwPCHW3UrvVayUfEQi6UrjTNre3/KJEqxPJxRFAAIE+EiDU3crJItTdSu2Wr5Wx/JrxZdHVOslvv1Zz4igEEEBguAUGI9QN9xwyegQQQAABBBBAYECWX5lIBBBAAAEEEEBgyAWo1A35DcDwEUAAAQQQQGAwBAh1gzGPjAIBBBBAAAEEhlyAUDfkNwDDRwABBBBAAIHBECDUDcY8MgoEEEAAAQQQGHIBQt2Q3wAMHwEEEEAAAQQGQ4BQNxjzyCgQQAABBBBAYMgFWgt1/s8f7btHsn/0fsgnhOEjgAACCCCAAAJ1BFoLdVFnjy0t66nVFzV9+GSd/tMGAQQQQAABBBBAwInffj2+qAuPX9Ce2eNMCAIIIIAAAggggEBNgdYrdSLU1Zw6miGAAAIIIIAAAl0BQh13AwIIIIAAAgggMAAC7Ye6H/9O556f1Gt7D+jYAIAyBAQQQAABBBBAoA2B9kOdN2o/2E3p3pUlnq1r4y7gmggggAACCCDQ9wLthzrvmbqZVc1PPyP2v/b9/cQAEEAAAQQQQKAlATdCHbtfW5p+LosAAggggAACgyJAqBuUmWQcCCCAAAIIIDDUAoS6oZ5+Bo8AAggggAACgyLQeqjjFyUG5VZiHAgggAACCCDQpkBroS7+7Ve9qyW+zqTNe4BrI4AAAggggMAACLQW6gbAjiEggAACCCCAAALOCBDqnJkKOoIAAggggAACCNQXINTVt6MlAggggAACCCDgjAChzpmpoCMIIIAAAggggEB9AUJdfTtaIoAAAggggAACzggQ6pyZCjqCAAIIIIAAAgjUFyDU1bejJQIIIIAAAggg4IwAoc6ZqaAjCCCAAAIIIIBAfQFCXX07WiKAAAIIIIAAAs4IEOqcmQo6ggACCCCAAAII1Bcg1NW3oyUCCCCAAAIIIOCMAKHOmamgIwgggAACCCCAQH0BQl19O1oigAACCCCAAALOCBDqnJkKOoIAAggggAACCNQXINTVt6MlAggggAACCCDgjAChzpmpoCMIIIAAAggggEB9AUJdfTtaIoAAAggggAACzggQ6pyZCjqCAAIIIIAAAgjUFyDU1bejJQIIIIAAAggg4IwAoc6ZqaAjCCCAAAIIIIBAfQFCXX07WiKAAAIIIIAAAs4IEOqcmQo6ggACCCCAAAII1Bcg1NW3oyUCCCCAAAIIIOCMAKHOmamgIwgggAACCCCAQH2B/wP/GpwdEAbGLwAAAABJRU5ErkJggg==\"","export default __webpack_public_path__ + \"static/media/forceFrameRate.74b07439.png\";","export default __webpack_public_path__ + \"static/media/scheduleCallback.dd6d5e44.png\";","export default __webpack_public_path__ + \"static/media/createLaneMap.5de6644c.png\";","export default __webpack_public_path__ + \"static/media/PACKED and HOLEY.709b8d3d.png\";","export default __webpack_public_path__ + \"static/media/promise.4534d79d.png\";","import Post1 from \"./Post1\";\r\nimport Post2 from \"./Post2\";\r\nimport Post3 from \"./Post3\";\r\nimport Post4 from \"./Post4\";\r\nimport Post5 from \"./Post5\";\r\nimport Post6 from \"./Post6\";\r\nexport default {\r\n  Post1,\r\n  Post2,\r\n  Post3,\r\n  Post4,\r\n  Post5,\r\n  Post6\r\n}","import React from 'react';\r\nimport fiberSturcture from './captures/fiber_structure.png'\r\nimport fiberRelationship from './captures/fiber_relationship.jpeg'\r\nimport workInProgress from './captures/workInProgress.png'\r\nimport useResetTop from './useRestTop';\r\nexport default function Post1() {\r\n  useResetTop();\r\n  return (\r\n    <>\r\n      <h1>React Fiber</h1>\r\n      <p>大家以前是否有听过<code>fiber</code>这种数据结构呢？它是于React16之后引入的，引入的主要原因就是为了解决<code>增量更新</code>的问题（Incremental Rendering）。</p>\r\n      <p>在React16以前，React用到的 reconciler（协调器）叫<code>stack reconciler</code>，它主要的特征是协调过程是<code>同步的，无法中断</code>。</p>\r\n      <p>你是否有疑惑：无法中断就无法中断呗，有什么大问题吗？</p>\r\n      <p>这是因为，在一个页面，浏览器只会分配<code>一个主线程</code>来处理包含js代码的执行、样式布局、事件响应及垃圾回收等在内的任务。如果一个任务的执行时间过长，其它任务的正常运行势必会受到影响。React的reconciliation过程并不算快，尤其当页面遇到比较大的更新时，协调会耗费比较多的时间。在这期间，用户无法与页面进行交互（因为主线程忙），整个页面卡住了，用户体验急剧下降。</p>\r\n      <p>为了解决这个问题，React引入了一种叫作 Fiber 的数据结构，新的协调器<code>Fiber Reconciler</code>，以及增量更新的概念。</p>\r\n      <p>什么是增量更新呢？它指的是React的协调可以被打断了，因为它在被打断后能够再恢复，之前的协调成果不会丢失（增量更新因此得名）。这样，React的协调不会阻塞浏览器对其它事件的处理，如响应用户事件、更新动画等等。在用户看来，页面并没有卡顿，还是高响应度的，用户体验得到了极大的提高！</p>\r\n      <p>有人可能会问了：“既然增量更新这么好，为什么以前不弄呢？”这是因为之前的Stack Reconciler没有使用类似于Fiber的数据结构。它没有把大的工作（Reconciliation）拆分成以Fiber为单位的一个个小的工作单元（UnitOfWork），也没有记录当前协调所处位置的机制，因此它不可能实现增量更新。</p>\r\n      <hr />\r\n      <p>好了，说了这么多，进入我们今天的正题，好好看下fiber长什么样吧</p>\r\n      <p>首先是Fiber的数据结构：</p>\r\n      <img src={fiberSturcture} />\r\n      <p>可以看到，fiber本质上是一个<code>JavaScript对象</code>，它涵盖了很多信息，包括Instance，也包括Effects。我们今天重点关注和Fiber树相关的四个属性——return、child、sibling和index</p>\r\n      <p>在React15及之前的版本，reconciliation会生成VirtualDOM树；在16之后，除了生成VirtualDOM树，还会生成Fiber树。VirtualDOM树和Fiber树的层级关系是差不多的，但还是有一些细微差别的，不能完全等同。另外，Fiber上还携带了fiber需要完成的工作信息（如更新DOM，移除Ref，调用回调函数等，这些记录在Effects相关字段上）。因此，Fiber在React源码中又被称作<code>UnitOfWork</code>（工作单元）。</p>\r\n      <p>我们继续来看Fiber的数据结构。Fiber的child指的是它的子节点，而return指的是它的父节点。如果碰到fiber有多个子节点的情况该怎么办呢？我们注意到，fiber的数据结构里并没有children，只有child。而child不能是数组，它只能指向一个特定的fiber。在这种情况下，sibling和index属性就派上用场了。假如父biber下有多个子fiber，那么父fiber会将child指向它的第一个子fiber，剩下的子fiber通过sibling属性相连——即第一个子fiber的sibling指向第二个子Fiber，第二个子Fiber的sibling指向第三个子Fiber……依此类推，最后一个子fiber的sibling值为null（代表它后面没有相邻的fiber了）。对于这些有sibling的子fiber来说，它们依靠index来判断它们在整个子级中的位置——第一个子fiber的index值为0，第二个index值为1……依此类推。</p>\r\n      <p>讲到这里，你应该对Fiber树的结构有一个比较清晰的认识了吧，以下是我从其它地方摘来的图片供大家参考：</p>\r\n      <img src={fiberRelationship} alt=\"\" />\r\n      <p>那为什么引入了Fiber后，协调的过程就是可中断再恢复的呢？首先，React的协调是有规律的，它采用的是深度优先算法，从根（HostRoot）出发，顺着child指针一路向下，找到最左边(index等于0)、最深层(child等于null)的那个fiber，计算出它待处理的Effects。然后看这个fiber有没有兄弟元素(sibling)，有的话将指针移到这个兄弟元素。再看这个兄弟元素有没有子元素，有的话我们也是顺着child指针一路向下，找到它最左边、最深层的那个子fiber，计算出该fiber待执行的Effects……一直重复这个过程。&emsp;当fiber没有兄弟元素(sibling为null)时，我们知道我们已经遍历完了这一层的所有子fiber，需要返回上一级了，这时我们就可以通过fiber的return属性找到上一级的那个fiber了。找到后首先我们计算出这个fiber所需要执行的Effects，然后把指针移向它的兄弟元素，再重复以上操作（找最左边、最深层的子Fiber）……这样一顿操作下来，我们就会回到当初的原点(HostRoot）了，整个协调过程完成。</p>\r\n      <p>协调对象如果是一颗比较大的Fiber树的话就会比较费时，因此我们需要一种机制来记录当前工作的进度，这样我们中断后再回来还能继续在之前中断的地方工作。为此，React定义了一个模块级别的变量：<code>workInProgress</code>。它的取值是null或Fiber。</p>\r\n      <img src={workInProgress} alt=\"\" />\r\n      <p>我们当前协调到哪个Fiber，只需要把这个Fiber的引用赋值给模块变量workInProgress就好了。这样当协调被中断、再回来继续工作时，只需要从workInProgress引用的那个Fiber出发，按深度优先算法一级级遍历即可，毋须担心工作进度的丢失，实现了协调的异步化。</p>\r\n    </>\r\n  )\r\n}","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAnUAAABUCAYAAADkmMHuAAAAAXNSR0IArs4c6QAAEEtJREFUeF7t3U2MXlUdx/HfQLUwnVGQYjNQDUOhDpBCgbYrGqkkGmNSbOO23YwkLDE1bIwBYtwYUJYkphtwaVokMUYTXkxZmA5CK0FKax2jhVooUJ2hthQYc9+e55xzz315nvs889y59+sKZu7LOZ9zn3l+/M8517HFxcUl5fzv7i235/2a3yGAAAIIIIAAAgjUQGCMUFeDUaAJCCCAAAIIIIBARQFCXUVATkcAAQQQQAABBOogQKirwyjQBgQQQAABBBBAoKIAoa4iIKcjgAACCCCAAAJ1ECDU1WEUaAMCCCCAAAIIIFBRgFBXEZDTEUAAAQQQQACBOggQ6uowCrQBAQQQQAABBBCoKECoqwjI6QgggAACCCCAQB0ECHV1GAXagAACCCCAAAIIVBQg1FUE5HQEEEAAAQQQQKAOAoS6OowCbUAAAQQQQAABBCoKEOoqAnI6AggggAACCCBQBwFCXR1GgTYggAACCCCAAAIVBQh1FQE5HQEEEEAAAQQQqIMAoa4Oo0AbEEAAAQQQQACBigKEuoqAnI4AAggggAACCNRBgFBXh1GgDQgggAACCCCAQEUBQl1FQE5HAAEEEEAAAQTqIECoq8Mo0AYEEEAAAQQQQKCiAKGuIiCnI4AAAggggAACdRAg1NVhFGgDAggggAACCCBQUYBQVxGQ0xFAAAEEEEAAgToIEOrqMAq0AQEEEEAAAQQQqChAqKsIyOkIIIAAAggggEAdBAh1dRgF2oAAAggggAACCFQUqE2om9p8j2YWXtGLJy94unSFbt6+RVcdf1lzZyr2WF/U1m/foHOHjurEYtVr5Zy/boN23jUVH7CgN437TW64Qzs2Tur0q3Z/wp9P/kPPHfnPEBs2xEuHfZ6w+jrEuw390uF4XPeuXjx0WguZdwuep02aWjxZcNzQm8sNEEAAAQRaLlCPUDcxpR3bx3Xsdyd12jcgQVjYeL7cl6YVpsyLndZceP3lCHXRF72c0Ja0hlC3Mj51hLqVMU60EgEEEEAgEqhFqAu+PLforYwqnRRU8daf7rVKF1X31r/jVv+WIdQVhdSMp68ZlTrF4Xnlf8TKhbqV3096gAACCCDQDIEahLqCkNVnQJIKQt2r72r9XRs0GYyjO3WWM3VaatjD833hJp6qCy9iT8kGP0lC3Zw2aWs8c2tP0UZ9umUibsXp142p2u4U9ampe+Lz0/fwtd8/9e1OeZttlxaOZ02Ve+6QVFpfk7Zsj82ttvd57YwKrh2O7WvbY51v5oa6wCkYl2RMkopr2GOrP8EPgvuu1alD5zWT9Nl5zqzzE7bUdTKeuPBzEVu69w9cps7qxYUbwmn+8GnrZbxKPeQchAACCCBQN4GRh7qi6lT+Wrs8zrxQt0lTMqdjjanS8MvyyzqVrIHLDGjpe3u/pDO/8NPr+pLzO1/Azr3DUKEkyLn96wa+5Hz7+Gwr/xiYoc69V/70cupOnZAcm1vGFa6dEfi7/bnoVGtjowXbMAjJPjMz1E0E9pP+dXN+vyRMlnvOwrHKuH565Fz/6N8nkuCWeCcBsYdnuG5/oGgPAggggEB5gRGHuqINEFWmSstPv5rBMT0VXNTGjMqUt1KXHOvvVzocmF/eceXHXHdoVarcwCKp7FrEuLITbNDoWqzubijRlHbcKb1ibBgoCuOWSmoDhWH6UZVrGyZGX4MAFm66Wbw+XTG1gmC+meKNEm8ubNAtOYErO9TZwd19zqxNGD0EL++0sDnWqXGv8jkq/8eEIxFAAAEERisw2lBXEDp6Cg4px/5CXTLF5l7O3amaO2yFX9BlQ50TfszptqQBnSm9PsJnco0g6ISh7bxmNq+VdFZzRxRNHwYhMmvzSdmpwrxxrnTtoM9fk147qsWbNmi9pFNHTkrJGkx5Nth4Ql3Wrmqz8po3fdlPqAsDt7FTuGxVNRgy7/0IdaP9S8rdEUAAgRoIjDTUDfc1Jv2HuuxXq5QcsYGFOiP8BdWyvB3C8RrC/l77Ele8XpVmJt7Wscnrpb+d10xSnStb8cviKQp1ZXc2e64fbaJ5Xdo4rmPHxzWjt3VuYxT0TqzxrG20xiY/CHcqYvFawMW83cypV9Gkg7v1vLtr4jrLAYqfMV+lzvoZlbpiRI5AAAEEGigwulBXtAGiapAo2ihhvDfO+rJNTRX2MeoDCnX2l7dnqtBqWoVKXbyo/9xxSWdO6t/r7tDM5KKmdDbeiOGs2eqVJHcsq107DHULJyV9qLkzV2vHTeNanFJUYQz7Zaw1Sz0TJUNdMO2c81z0U6nrf62opDgQdkOms8aOUNfrE8rxCCCAQCMERhbqiqZWK33phUPTX6UuPDU1JZgsdi855lmhzjvV2N2hmtpokXqhrbP71drVWCXUxddVvBEgDg2ydkw6u0iDDZ8ZlauUUmFA7//akZniFx47/Qgb4lw7Y8ew76XWbkXM3sgieydy0unO9Xut1AUX6OE5cyp91vQwoa7kB5XDEEAAgWYJjCjUDes1Js0aHHrTXAHff7T0sq6uuTL0DAEEEECgX4ERhbp+m8t5CDRBwFdFrjYN3QQV+oAAAgggUE2AUFfNj7MR6E8gtVGCFwT3B8lZCCCAAAKJAKGOZwEBBBBAAAEEEGiAAKGuAYNIFxBAAAEEEEAAAUIdzwACCCCAAAIIINAAAUJdAwaRLiCAAAIIIIAAAoQ6ngEEEEAAAQQQQKABAoS6BgwiXUAAAQQQQAABBAh1PAMIIIAAAggggEADBAh1DRhEutBkgW36y9Ip3T72TpM7Sd8QQAABBAYgMLJQN/6jl7R122TUhfln9ceHfjKA7oz6EmPafXCNpk98pCceXhp1Y7h/WYHdn9O+B1dr4l/n9djsZ52zpn92pfZec9H6WdlLDu645Q91RZ/NtU/+WbdNRz08f/hJzf30mcF1d4hXyu/Xj3Xbb76rteH9FzT/i3v1z5eG2BgujQACCAxBYGShLulL+If22ud7D3X3PqWtP1ir+fu/p7NDgOnvkgWhbt/n9ci3Pu9c+mO98M2Pdajwhpdp9g/jWm8e54SQwku08IAwmG2+3Or54hEndBPqvE9G0WczCHfT762cUFfub04Q7u7TAqGuhX8t6DICK1+AUDfQMSxZqQvDnUqGuaSBUajT7xe1/4ngZ9G9Nn1gV5cG2p0GXKxKta3KuYOjW/5KXbnwIxHqBjfKXAkBBBAYhECNQ505HWJO89g/7yKUmTKJgtDVLyfByAxMq/XhU//TgQOSW9051QlSkoJAds+Snn5G2h1M2QWX6FTM3FCXVNecalxGqAvuu1sXdPiaNfrGV6K2de/thrq4LZ1w2O3b8Vsn4vM/1etxn4Jr5fZLnkqgkvOLrx26dKqQ9n17vvdHF/X0rkuaN57wvUv36YdL0uHLntf3e3jyi4LZ9v2JleRW8JJzX9C4ZzyMYL0mbpBVOS1hVqoffYS62V/r65uOau69+zpLHMxp0lQFLqPqXbtK3bL0K79S9+jBI9o1/Xcd3Lxbj5YaPw5CAAEElk+gpqFuj776zENadyyZ2omCnJ67W2/sj3H6nH4NvsS3ve+ueQsCTRzqpp0qWhhWLu+Go054iYNaOHW3SvNheDJD3VhYWbvKneoLmp8T6oKpwiRchKHi5k/igFMu1G1a0w0nYWBRXMlz7+n0yzo2no4851YFs65tGXj6F/5+TIczppn9Y2J/CIYV6pK7+NqQhOBO2HMMLbO4ctpdTxlXUrPMSn/G+wx1O6e7a1WDMLRTeiNeqrCiQ93Q+0WoK/1ociACCNROoJ6hLghss9Ibex7U+Zis7BdRkXBSDXviYXWrdvNJ6Likaz0bHawvfDfkxV/mUfUvCXUXdW7zan+gKwp15sJ8Kwy5oS76925o9EzHJlXFXZ/oztx+RQHUndpNBRRzqrdz7UtSXGHsbg5xKqKpkGiPUhiOvpSuzhWNZZnf+9bUWZXX+CKZoc7aKGGOQfDPq3TcDKqGybxvetz6fZnWB8f0GeruPau5zufHDiplP0uDr9Rdp2c/26YbU11/U49f9paeLiIJwunQ+8WauqJh4PcIIFBfgXqGurCyEG+vM+3MXbJ9VurCKtmtn+ix316u2e+MSe9f0v4/rdK+PdKBOPy407OpUBdMvzrTg1Ezu9UZdaYuPYOfV6krCHXmRgl7ujBrarnbrux+RQG3sz7PrbxZwTXdH3MK0/xtato6mZ5NTa+abuaUc/UPTtH0a2Glzgp1hnH4HwLx9LvZzE7f8sajl341KdT10m/PsYS6ioCcjgACTReob6iz/ovcMwz9hrogsOyRDp9YpY1nLujDW1fptb+OaW8Q9GaXPK8kcdbJ5VZbusce0BXau/lT/2aICqGuW01zTYpDnf2qFbtfbjArHxilMtOnZmtzK3MFVb1eP5CDDXXGNL3yp5STgJ9ev9lrD5oU6qjU9Tr6HI8AAgj0IlDPUKdoDd147juwPOvsyvQ8DnXzH4zpvdmPpf1XaqOkq96/EL5bLpquM8KYby1aQaUuCU+Z4WXZQ12ySSKjXwVr3goDSmpKOn8g7LWC7rGetYOSRramzqjU2e0u2n1c80rdzLF4ejbZeDTfWXOXjMjgp1/LfEBzjilTqavcrzJr6hZ0+PHteuBXFfvD6QgggMCABUYU6qKNENNfcHpjvYQ4vcv1rLlRIjjVmqYts/s1OCne5ZnsVIw3PphThfY6LGcnZ8lKXbS+LJlWjK8RbsLIfk9dqqqUu6aul0pddGxev3xTqN1qXYmAknoHX3fHb3pdm7kbOL3rNvUeuaGFOt+O3+5Gk1S7C6aNA+OezEp9mAdfqZPMz9+C5p87pnU7k3c+Fn02/bvPl+UlxAWhrlK/vEs+0n9T9v7ykPZtndR/536u7Q8UrgIsNcIchAACCAxKYEShblDN5zoDEfBV6lLr6gZyJy7Ss0Afoa7ne3BCaYHHDujo/ddSqSsNxoEIILCcAoS65dSu670808Gpaei6tr3x7SLU1WOIH9HBI7t0o5h6rcd40AoEEPAJEOp4LkKB9PRr2f/7MgCHK0CoG64vV0cAAQSaI0Coa85Y0hMEEEAAAQQQaLEAoa7Fg0/XEUAAAQQQQKA5AoS65owlPUEAAQQQQACBFgsQ6lo8+HQdAQQQQAABBJojQKhrzljSEwQQQAABBBBosQChrsWDT9cRQAABBBBAoDkChLrmjCU9QQABBBBAAIEWCxDqWjz4dB0BBBBAAAEEmiNAqGvOWNITBBBAAAEEEGixAKGuxYNP1xFAAAEEEECgOQKEuuaMJT1BAAEEEEAAgRYLEOpaPPh0HQEEEEAAAQSaI0Coa85Y0hMEEEAAAQQQaLEAoa7Fg0/XEUAAAQQQQKA5AoS65owlPUEAAQQQQACBFgsQ6lo8+HQdAQQQQAABBJojQKhrzljSEwQQQAABBBBosQChrsWDT9cRQAABBBBAoDkChLrmjCU9QQABBBBAAIEWCxDqWjz4dB0BBBBAAAEEmiNAqGvOWNITBBBAAAEEEGixAKGuxYNP1xFAAAEEEECgOQKEuuaMJT1BAAEEEEAAgRYLEOpaPPh0HQEEEEAAAQSaI/B/RIT2yVoSaQEAAAAASUVORK5CYII=\"","import React from 'react';\r\nimport Tag from './Tag';\r\nimport imgCreateUpdate from './captures/createUpdate.png'\r\nimport TypeLane from './captures/LaneType.png'\r\nimport Lanes from './captures/Partial_Lanes.png'\r\nimport useResetTop from './useRestTop';\r\nexport default function Post2() {\r\n  useResetTop();\r\n  return <>\r\n    <h1>React Fiber Lane</h1>\r\n    <p>React Fiber Lane 是React于 2020年 引入的，它最早的 PR 可以追溯回这一条：<Tag link=\"https://github.com/facebook/react/pull/18796\">Initial Lanes implementation</Tag></p>\r\n    <p>Lane 英文翻译为小巷和车道，但它在React中有另外特殊的意义 —— 具体特殊在哪呢？下面我们来一探究竟！</p>\r\n    <p>首先我们得从 lane 的前身 <Tag link=\"https://github.com/facebook/react/pull/10426\">expirationTime</Tag> 说起。expirationTime的意思是过期时间，是Update上的一个属性。当用户触发了一个更新（setState、 replaceState或forceUpdate等），React就会创建一个Update对象，并将 expirationTime 值赋给它：</p>\r\n    <img src={imgCreateUpdate} alt=\"\" />\r\n    <p>那么Update的expirationTime的值由谁决定的呢？它是由优先级决定的——优先级高的，它的过期时间自然短；而优先级低的，过期时间就会被延长。具体逻辑请参考 <Tag link=\"https://github.com/facebook/react/blob/3019210df2b486416ed94d7b9becffaf254e81c4/src/renderers/shared/fiber/ReactFiberExpirationTime.js#L61-L95\">priorityToExpirationTime</Tag>。</p>\r\n    <p>ExpirationTime机制的引入不仅能为不同级别的Update定义对应的优先级，还能防止低优先级更新一直被高优先级更新阻塞产生starvation（这是因为随着时间的推进，低优先级的expirationTime会离当前时间越来越近，这样它的优先级会随之提高，从而避免了一直被阻塞）。</p>\r\n    <p>这个模型看起来没什么问题，直到Suspense组件的出现。Suspense的作用是懒加载，它允许其内部定义的组件发送IO请求，等IO请求结束后再将组件渲染到屏幕上。Suspense的引入带来了一个新的概念，即 IO-bound，也就是说组件的更新和 IO 相关。在Suspense以前，其他更新都属于 CPU-bound（和CPU相关）。</p>\r\n    <p>在Suspense出现以前，React处理更新的模型是这样的：“低优先级的更新要想完成，必须同时把高优先级带上”。这句话是什么意思呢？官方给出了一个例子方便理解：假定有A、B、C三个更新，它们的优先级顺序是A>B>C，那么你想完成B更新就必须同时把A更新带上，你想完成C更新就必须同时把A和B都带上。</p>\r\n    <p>但是当Suspense出现以后，更新就不完全是CPU-bound了，它还可以是IO-bound。假定有以下场景：同时存在一个高级别的IO-bound更新和一个低级别CPU-bound更新，如果我们想要完成这个低级别的CPU-bound更新，就必须同时把高级别的IO-bound更新也带上。但IO与CPU的处理时间不是一个级别的，IO可能要好几秒，而CPU几毫秒就能完成了。按照之前的模型，让低级别的CPU-bound更新一直去等待高级别的IO-bound更新显然是不合理的，它造成了资源的大量浪费。于是React提出了一个新的模型：React Fiber Lane。</p>\r\n    <p>Lane是一个什么样的东西呢？首先，在JavaScript中，Lane是一个数字。更具体地说，Lane是一个4字节、32位的数字：</p>\r\n    <img src={TypeLane} alt=\"\" />\r\n    <p>React用这32位数字的不同组合来表示不同的优先级，以下对Lane定义的源码做一个节选：<span style={{ display: 'none' }}><Tag link=\"https://github.com/facebook/react/blob/a8cabb5648a14ef55cb96d679a526e3f731e9611/packages/react-reconciler/src/ReactFiberLane.new.js#L31-L79\">源码</Tag></span></p>\r\n    <img src={Lanes} alt=\"\" />\r\n    <p>可以看到，大部分Lane的定义都是以 0b 开头，加上一串0、1序列的数字（0b代表二进制）。每个序列里一般只有一个1，其余都是0。最右边的1代表最高优先级，最左边的1代表最低优先级，如SyncLane：0b0000000000000000000000000000001（最高优先级）和OffscreenLane：0b1000000000000000000000000000000（最低优先级）。</p>\r\n    <p>我们来看一下Lane模型比expirationTime模型好在哪。1. Lane只占4个字节，但它却可以表示至多31种优先级别，说明它在空间上很占优势（内存）。2. Lane的操作非常快，它的所有操作都是基于位的，不需要做额外的转换。这说明它在时间上也占优势（CPU）。这里我们简单地展示下常见的几种位操作，方便大家对它的理解：</p>\r\n    <p>1. 判断某一位上是否为1：<br /><span style={{ textIndent: '2em', display: 'inline-block' }}>假定有一个4字节的数字，我们想知道它从右往左数第3位数字是否为1，只需要将该数字与0b100做一次<code>&</code>运算，若结果不为0，则说明该数字从右往左数第3位为1： <code>test_number & 0b100 !== 0</code></span></p>\r\n    <p>2. 计算两个数字所有位为1的并集：<br /><span style={{ textIndent: '2em', display: 'inline-block' }}>假定有两个数字，我们想知道当它们用二进制表示时，所有值等于1的位进行合并，会产生出一个什么样的新数字，那我们可以对这两个数字进行一个<code>|</code>运算，比如： <code>0b100 | 0b101 === 0b101</code></span></p>\r\n    <p>3. 拿到数字最右边值为1的那一位所代表的数的大小：<br /><span style={{ textIndent: '2em', display: 'inline-block' }}>比如有个数字 0b1100，我们想知道它最右边的那个1代表的数值大小（0b1100最右边的1的大小为4），我们可以对它自身与其相反数进行一次<code>~</code>操作，具体是： <code>lane ~ -lane</code>，这样我们就拿到最右边那位1所代表的值大小了。不信你试一下！</span></p>\r\n    <p>………………（位的常规操作还有很多，这里不一一列举了）</p>\r\n    <p>总的来说，这篇文章的主题是Lane作为expirationTime的替代品出现在React中的。它们虽然都被用来表示优先级，但Lane解耦了两个被expirationTime混淆的概念：1. 权限大小(priority) 2. 批次(batch)。 在Lane模型中，权限大的更新可以和权限小的更新分批次去执行（通过给它们分配不同的Lane），但expirationTime会把权限大小与批次捆绑在一起。另外，Lane无论是在时间（位操作）还是空间（4字节）上都更具优势，因此 Lane 取代了 expirationTime！！<span style={{ display: 'none' }}>因为权限大的可能是IO-bound，而权限小的可能是CPU-bound。</span><span style={{ display: 'none' }}>在原先的expirationTime模型，权限大的一定要比权限小的先执行，或者说权限小的想要执行，必须同时完成权限大的。expirationTime把这两个概念混在了一起。但这种模式到了Suspense就不起作用了，因为有可能出现权限高的IO-bound更新和权限低的CPU-bound更新，这种情况下我们不应该把它们放在同一批次，也就是说即使权限大的不应阻塞权限小的。是需要分批(unbatch）去处理这两个更新的，不能把它们放在一起。</span></p>\r\n  </>\r\n}","export default \"data:image/png;base64,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\"","import React, { useState, useEffect } from 'react';\r\nimport SrcEventLoop from './captures/event_loop.png';\r\nimport Tag from './Tag';\r\nimport useResetTop from './useRestTop';\r\nimport picForceFrameRate from './captures/forceFrameRate.png'\r\nimport picScheduleCallback from './captures/scheduleCallback.png'\r\nexport default function Post3() {\r\n  useResetTop();\r\n  return (\r\n    <>\r\n      <h1>React Scheduling</h1>\r\n      <p>这篇文章主要讲的是React的<Tag link=\"https://www.npmjs.com/package/scheduler\">Scheduler</Tag>模块如何与浏览器事件循环相结合，形成协调调度（Cooperative Scheduling）。</p>\r\n      <p>首先，我们要理解什么是事件循环：JS运行时（runtime）是单线程的，它会将代码从上往下依次执行，中间不能跳过。如果中途碰到IO请求呢？比如发送Ajax或IndexDB读写。由于IO请求与CPU的处理速度不在同一数量级，如果我们阻塞程序的运行而去等待IO操作完成，无疑会大大浪费系统资源（CPU一直处于idle状态），并且主线程也会受到阻塞。</p>\r\n      <p>因此，JS中采用了事件循环机制。当代码中遇到IO请求时，它会告诉操作系统需要执行怎样的IO请求，操作系统则在请求结束后将IO处理结果交还给浏览器。在操作系统处理的过程中，浏览器仍可以处理包括像用户输入、脚本执行、界面渲染等在内的其它任务，避免了资源的浪费。 当浏览器拿到操作系统给它的处理结果后，它会将用户注册的回调函数推入到待执行任务队列中(task queue)，等待事件循环拿到该回调函数并将它推到调用栈中去执行。</p>\r\n      <p>以下是摘自MDN事件循环的伪代码：</p>\r\n      <img src={SrcEventLoop} style={{ marginLeft: '2em' }} />\r\n      <p>好了，了解了什么是事件循环，进入我们今天的正题：Cooperative Scheduling。</p>\r\n      <p>我们知道，自16版本以后，React一直致力于如何在执行任务的同时，让程序保持高响应性。这个问题的关键是JS运行时是单线程的，各种任务（包括视图渲染、响应用户输入、垃圾回收）都在主线程（main thread）上执行，如果React占用了主线程太多时间，浏览器就不能及时地处理用户输入，<span style={{ display: 'none' }}>比如鼠标单击、滚轮滑动等，</span>造成程序卡顿的现象。为了能给予浏览器充足的时间响应用户的输入，React Scheduler采用了这样一种方案：默认只执行 5ms （<code>yieldInterval</code>）的任务，5毫秒之后就将控制权返还（yield）浏览器，让浏览器处理其它必要的事务。通过怎样的方式返还呢？React使用了MessageChannel，通过\"message\"事件，将未完成的任务以宏任务的方式推到浏览器任务队列当中，等待<code>event loop</code>的轮询（为啥子不用setTimeout？因为setTimeout有一个时间上的clamping，大约是4ms。4ms看上去很短，但对CPU来说却是很长一段时间了）。</p>\r\n      <p>这个模型看上去没什么问题，但细心的读者可能就会问了：如此频繁地将控制权在浏览器和脚本之间切换，是否会带来更多不必要的开销（overhead），如context的切换？另外，浏览器有更多的控制权意味着React Scheduler的控制权更少，可分配的时间也更少，这是否会造成原本很快能执行完的任务，在这种新模式下就会被无限期延长呢？对于第一个问题，React是可以通过<Tag link=\"https://github.com/facebook/react/blob/a8cabb5648a14ef55cb96d679a526e3f731e9611/packages/scheduler/src/forks/Scheduler.js#L498-L513\">forceFrameRate</Tag>函数来设置控制权交还的时间间隔<code>yieldInterval</code>的：</p>\r\n      <img src={picForceFrameRate} alt=\"\" />\r\n      <p>对于第二个问题，Scheduler的每个任务都有权限级别与过期时间。Scheduler只有在当前任务未过期，且yieldInterval已经触碰到的情况下，将控制权交还给浏览器；如果当前任务已过期了，那么Scheduler会义无反顾地将这个任务执行完成，并不会去理会当前是否已经超过了yieldInterval设置的<code>deadline</code>！</p>\r\n      <hr />\r\n      <p>如果你对React的Scheduler比较感兴趣，下面我会讲解一下该模块的实现细节：</p>\r\n      <p>Scheduler里有两个存放任务的队列，分别是<code>timerQueue</code>和<code>taskQueue</code>，采用的数据结构是<code>minheap(最小堆)</code>，以数组形式实现。为什么采用最小堆呢？因为Scheduler的任务队列是一个优先队列<code>Priority Queue</code>，优先级高的必须比优先级低的先处理。采用最小堆的结构，无论从<code>添加一个新任务</code>，还是从<code>获取最高优先级任务</code>的方面考虑，它的时间复杂度都比其它数据结构更具有吸引力！</p>\r\n      <p>那 timerQueue 和 taskQueue 分别是啥？React Scheduler创建新任务的时候允许使用<code>delay</code>选项，来表示这个任务在delay时间过后才生效。使用了delay选项的任务会被推入timerQueue中，没有使用delay选项的任务则被推入taskQueue中。React Scheduler每次执行任务都是从taskQueue里面取的，而timerQueue里的任务，React会根据delay设置一个定时器，当delay时间到后，timerQueue里符合条件的任务就会被推送到taskQueue上面，React Scheduler便可以从中拿取任务执行。也就是说，timerQueue上的任务可以流入taskQueue当中。</p>\r\n      <p>下面是Scheduler创建新任务时的代码实现：</p>\r\n      <img src={picScheduleCallback} alt=\"\" />\r\n      <p>其它相关代码请参考<Tag link=\"https://github.com/facebook/react/blob/a8cabb5648a14ef55cb96d679a526e3f731e9611/packages/scheduler/src/forks/Scheduler.js\">github</Tag></p>\r\n    </>\r\n  )\r\n}","import React, { useState, useEffect } from 'react';\r\nimport Tag from './Tag';\r\nimport useResetTop from './useRestTop';\r\nimport ImgCreateLaneMap from './captures/createLaneMap.png'\r\nimport ImgNewArray from './captures/newArray.png'\r\nimport ImgPACKEDandHOLEY from './captures/PACKED and HOLEY.png'\r\nexport default function Post4() {\r\n  useResetTop();\r\n  return (\r\n    <>\r\n      <h1>V8下数组创建的优化</h1>\r\n      <p>在前段时间阅读React代码过程中，我发现<code>createLaneMap</code>函数的一行代码注释特别有意思：</p>\r\n      <img src={ImgCreateLaneMap} style={{ marginLeft: '2em' }} />\r\n      <p>这个函数作用很直观——就是创建一个给定长度（长度为<code>TotalLanes</code>）、且给定初始值（初始值为<code>initial</code>）的数组。</p>\r\n      <p>按照我们平时的思路，我们一般都是这样创建的：</p>\r\n      <img src={ImgNewArray} style={{ marginLeft: '2em' }} />\r\n      <p>这两种方式有什么区别呢？想探清楚，我们不妨看看<Tag link=\"https://v8.dev/blog/elements-kinds#avoid-creating-holes\">https://v8.dev/blog/elements-kinds#avoid-creating-holes</Tag>里都提到了啥。下面是我看完文章后做的一点小总结：</p>\r\n      <p>这个问题的核心是V8的元素种类（<code>elements kinds</code>）。我们知道，JS的对象可以有任意类型的属性，属性的名字也可以是任意字符；当属性名称为数字时，V8会对它们做特殊的优化处理。在V8内部，这种类型的属性有一个特殊的名字，叫元素（<code>elements</code>），数组便属于这一范畴——因为数组的属性名，即下标都为数字。</p>\r\n      <p>下面介绍V8里常见的三种 elements kinds：1. <code>PACKED_SMI_ELEMENTS</code> 2. <code>PACKED_DOUBLE_ELEMENTS</code> 3. <code>PACKED_ELEMENTS</code></p>\r\n      <p>如果一个数组里面的值全是整数，那么它的 element kind 为<code>PACKED_SMI_ELEMENTS</code>，如数组 [1] ；如果一个数组里面的值既有整数，又有小数，或者只有小数，那么它的 element kind 是<code>PACKED_DOUBLE_ELEMENTS</code>，如数组 [1, 1.1] 和 [1.1] ；如果一个数组里面的值包含了非数字类型，如字符串，那么它的 element kind 为<code>PACKED_ELEMENTS</code>，如数组 ['a', 'b', 'c']。一个数组的 element kind 是<code>可以在运行时改变</code>的，如我们初始化数组 const arr = [1]，这时它的 element kind 为 PACKED_SMI_ELEMENTS。接着我们往数组里推一个浮点数，如 arr.push(5.5)，这时 arr 的 element kind 会从 PACKED_SMI_ELEMENTS 变为 PACKED_DOUBLE_ELEMENTS。最后我们再往数组里推一个字符串，如 arr.push('a')，那么 arr 的 element kind 就从 PACKED_DOUBLE_ELEMENTS 变为 PACKED_ELEMENTS 了。还有一点非常重要，就是 element kind 只能从<code>更具体</code>向<code>更通用</code>转换，也就是遵循 PACKED_SMI_ELEMENTS -> PACKED_DOUBLE_ELEMENTS -> PACKED_ELEMENTS这样的转换方向，而不支持从 PACKED_ELEMENTS -> PACKED_DOUBLE_ELEMENTS -> PACKED_SMI_ELEMENTS 这样的转换方向。</p>\r\n      <p>上面我们介绍的三种 element kind 都属于<code>PACKED</code>类型，而接下来我们来看数组的另外一种类型，就是<code>HOLEY</code>。HOLEY 是什么意思呢？用专业术语来讲就是 稀疏型(<code>sparse</code>)数组，而 PACKED 则属于密集型(<code>dense</code>)数组。稀疏型数组 可以通过以下表达式来判断：<code>0 ≤ i &lt; arr.length && !(i in arr)</code>，其中 i 指的是数组的下标。另外，PACKED 可以降级为 HOLEY，但 HOLEY 不能转换为 PACKED。假设我们有一个 PACKED 类型数组：const array = [1, 2, 3, 4.56, 'x']，然后执行 array[9] = 1，这个数组就由 PACKED 变成 HOLEY 了，array[5] 到 array[8] 都是<code>holes</code>。之所以这样区分，是因为相较于 HOLEY，V8会对 PACKED 数组上的方法做更多优化（如 map, reduce, forEach 等方法）。简而言之，密集型数组（<code>PACKED ELEMENTS</code>）比稀疏型数组（<code>HOLEY ELEMENTS</code>）更高效。因此，这对我们有什么启示呢：</p>\r\n      <p>1. 使用数组而不是类数组对象。这里有个经典的例子就是函数的arguments对象，它属于类数组。有时候我们会在arguments上执行类似<code>Array.prototype.forEach.call(arguments, (value, index)=>&#123; &#125;)</code>的操作。如果你只打算在arguments上执行一次数组操作，这是可以被接受的。但是，如果你打算在arguments上执行多次数组操作，那么一定要先把arguments对象转化为真正的数组类型<code>const actualArray = Array.prototype.slice.call(arguments, 0)</code>。这是因为数组方法在数组上调用是被极大优化过的，比将类数组当数组来调用高效不知道多少倍。</p>\r\n      <p>2. 永远不要越界读取数组下标，它会对数组的性能造成极大的负面影响。如有一个数组，它的长度是5。如果你试图去读取 arr[10]，那么JS引擎必须去执行昂贵的原型链查找（<code>JavaScript engine has to perform expensive prototype chain lookups</code>），并且它会标记这个“不同寻常”的数组，导致该数组的操作不会像之前那么快了。</p>\r\n      <p>3. 不要使用<code>new Array(length)</code>这种构造数组的方式了，它将导致这个数组从一开始就被标记为 HOLEY_SMI_ELEMENTS，性能方面大打折扣。我们可以先创建一个空数组，然后往里面推元素，如：</p>\r\n      <img src={ImgPACKEDandHOLEY} style={{ marginLeft: '2em', marginBottom: '3em' }} />\r\n    </>\r\n  )\r\n}","export default \"data:image/png;base64,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\"","import React, { useState, useEffect } from 'react';\r\nimport Tag from './Tag';\r\nimport useResetTop from './useRestTop';\r\nimport ImgPromise from './captures/promise.png'\r\nexport default function Post5() {\r\n  useResetTop();\r\n  return (\r\n    <>\r\n      <h1>Promise/A+ 实现</h1>\r\n      <p><Tag link=\"https://gist.github.com/FranklyCai/76d8a043e62fd43eab78916fc5a7bb1d\">gist地址：https://gist.github.com/FranklyCai/76d8a043e62fd43eab78916fc5a7bb1d</Tag></p>\r\n      <img src={ImgPromise} style={{ marginLeft: '2em', marginBottom: '1.5em' }} />\r\n    </>\r\n  )\r\n}","import React, { useState, useEffect } from 'react';\r\nimport Tag from './Tag';\r\nimport useResetTop from './useRestTop';\r\nexport default function Post5() {\r\n  useResetTop();\r\n  return (\r\n    <>\r\n      <h1><code>Enhanced Vue.js devtools</code>、<code>Mini Fiddler</code>和<code>Webstorm Undo Style</code></h1>\r\n      <p>这三款插件是比较久之前写的了（点👇👇链接可直接跳转）<br /><span style={{ paddingLeft: '2em' }}>①</span> <Tag link=\"https://chrome.google.com/webstore/detail/enhanced-vuejs-devtools/ceondjobkkcjpcmkcggnpoenhhimmkln?utm_source=chrome-ntp-icon\">Enhanced Vue.js devtools</Tag><br /><span style={{ paddingLeft: '2em' }}>②</span> <Tag link=\"https://chrome.google.com/webstore/detail/mini-fiddler/gomcdidndbfecfhoppdhfhgbnachdilc?utm_source=chrome-ntp-icon\">Mini Fiddler</Tag><br /><span style={{ paddingLeft: '2em' }}>③</span> <Tag link=\"https://marketplace.visualstudio.com/items?itemName=caizhenccc.webstorm-undo-style\">Webstorm Undo Style</Tag></p>\r\n      <p><code>Enhanced Vue.js devtools</code>是一款Chrome插件，它的开发初衷是以前写Vue的代码时，有时候会看到控制台报key重复的错误。但控制台提供的信息并不完善，不能帮我们很好地定位究竟是哪部分代码导致的key重复。利用这个插件，我们可以精准定位到是哪个DOM的key重复，和其它有用的信息，帮助我们更快排查这种类型的错误。个人感觉这款插件的实用性挺强的！</p>\r\n      <p><code>Mini Fiddler</code>也是一款Chrome插件，开发原因主要是因为进行网络调试时有时会用到<code>Fiddler</code>客户端，但每次都得打开客户端就显得比较麻烦，于是想着能不能把 Fiddler 的功能做成Chrome插件，这样就不用多开一个软件了 —— Mini Fiddler 应运而生。目前它实现的功能还比较有限，只能算是Fiddler的一个子集，有兴趣的朋友可以试下！</p>\r\n      <p><code>Webstorm Undo Style</code>是一款VSCode插件，因为我大学实习的时候用的IDE是Webstorm，当转到VSCode之后，我发现VSCode在撤销与反撤销的时候，有些情况下不能很好地跳转到我们修改的位置，导致我们按了撤销或反撤销之后，VSCode执行了修改，但我们不知道修改了什么地方（因为VSCode视图没有跳转到我们修改的那个地方）。于是，我查阅了VSCode的API，开发了这款插件，以帮助解决这一问题！</p>\r\n    </>\r\n  )\r\n}","export default __webpack_public_path__ + \"static/media/cd-icon-location.3df4df56.svg\";","export default __webpack_public_path__ + \"static/media/cd-icon-movie.cd657a03.svg\";","export default __webpack_public_path__ + \"static/media/cd-icon-picture.cf28d9b1.svg\";","import React, { useEffect, useRef } from 'react';\r\nimport IconLocation from '../../assets/images/cd-icon-location.svg';\r\nimport IconMovie from '../../assets/images/cd-icon-movie.svg';\r\nimport IconPicture from '../../assets/images/cd-icon-picture.svg';\r\n\r\nimport { useInView } from 'react-intersection-observer';\r\n\r\nconst picLoop = [IconPicture, IconLocation, IconMovie];\r\nconst picClassNameLoop = ['cd-picture', 'cd-movie', 'cd-location'];\r\n\r\nexport default function PostItem(props) {\r\n  const { setPost, post, index } = props;\r\n  const animated = useRef(false);\r\n  const { ref, inView, entry } = useInView({\r\n    threshold: 0.18,\r\n  });\r\n  useEffect(() => {\r\n    if (inView == true && animated.current == false) {\r\n      animated.current = true;\r\n    }\r\n  }, [inView])\r\n  return (\r\n    <div className='cd-timeline-block' ref={ref} data-inview={inView}>\r\n      <div className={`cd-timeline-img ${picClassNameLoop[index % 3]} ${animated.current ? '' : inView ? 'bounce-in' : 'is-hidden'}`}>\r\n        <img src={picLoop[index % 3]} alt='Picture' />\r\n        {/* <span className='cd-date'>{post.date}</span> */}\r\n      </div>\r\n      <div className={`cd-timeline-content ${animated.current ? '' : inView ? 'bounce-in' : 'is-hidden'}`} onClick={() => setPost(`Post${index + 1}`)}>\r\n        <h2>{post.title}</h2>\r\n        <p>\r\n          {post.desc}\r\n        </p>\r\n        <span className='cd-read-more'>\r\n          阅读更多\r\n        </span>\r\n      </div>\r\n    </div>\r\n  )\r\n}","import React, { useCallback, useEffect, useLayoutEffect, useState } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport { BrowserRouter as Router, Link, Route } from 'react-router-dom';\r\n// import Post from '../Post';\r\nimport { withRouter } from \"react-router\";\r\nimport postMap from '../../posts'\r\nimport { CSSTransition, TransitionGroup, SwitchTransition } from 'react-transition-group';\r\nimport PostItem from './PostItem';\r\n\r\nlet timeLineScrollTop = 0;\r\n\r\nconst postInfo = [\r\n  {\r\n    title: 'React Fiber',\r\n    desc: '这篇文章会为我们解密React Fiber是什么以及Fiber解决了什么问题',\r\n  },\r\n  {\r\n    title: 'React Fiber Lane',\r\n    desc: 'React Fiber Lane是React新引入的优先级机制，它解决了expirationTime模型的一些痛点！具体是什么呢？这篇文章将为我们揭开其神秘面纱',\r\n  },\r\n  {\r\n    title: 'React Scheduling',\r\n    desc: '这篇文章详细剖析React的协调调度算法，分析React是如何与浏览器配合达到高响应的',\r\n  },\r\n  {\r\n    title: '每日Tip',\r\n    desc: '这篇介绍我在源码阅读过程中发现的一个关于V8下数组创建优化的一个小Tip',\r\n  },\r\n  {\r\n    title: '手写Promise',\r\n    desc: '这是我根据Promise/A+规范自己书写的一个Promise',\r\n  },\r\n  {\r\n    title: 'Chrome以及VSCode插件',\r\n    desc: '这篇文章会简单介绍下我之前开发过的两款Chrome插件和一款VSCode插件',\r\n  },\r\n]\r\n\r\nfunction Timeline(props) {\r\n  const [post, setPost] = useState(null);\r\n  const PostComponent = postMap[post];\r\n  const refCallback = useCallback((ref) => {\r\n    if (ref) {\r\n      const reminded = sessionStorage.getItem('reminded');\r\n      if (!reminded) {\r\n        sessionStorage.setItem('reminded', true);\r\n        setTimeout(() => {\r\n          ref.classList.add('jump')\r\n        }, 400)\r\n      }\r\n    }\r\n  }, [])\r\n  useLayoutEffect(() => {\r\n    if (post) {\r\n      timeLineScrollTop = window.scrollY;\r\n    } else {\r\n      window.scrollTo(0, timeLineScrollTop);\r\n    }\r\n  }, [post])\r\n  return (\r\n    <SwitchTransition>\r\n      <CSSTransition classNames=\"slide\" timeout={400} key={post}>\r\n        {post === null ? <section id='cd-timeline' className='cd-container'>\r\n          {postInfo.map((post, index) => (\r\n            <PostItem post={post} index={index} setPost={setPost} key={index.toString()} />\r\n          ))}\r\n        </section>\r\n          : <div>\r\n            <div id=\"post_container\">\r\n              <div className=\"window_header\">\r\n                {/* <div class=\"circle\" /> */}\r\n                <span className=\"circle circle1\" ref={refCallback} title=\"返回\" onClick={() => setPost(null)} />\r\n                <span className=\"circle circle2\" />\r\n                <span className=\"circle circle3\" />\r\n              </div>\r\n              <div className=\"post_content\">\r\n                <PostComponent />\r\n              </div>\r\n            </div>\r\n            <div style={{ height: '130px' }}></div>\r\n          </div>}\r\n      </CSSTransition>\r\n    </SwitchTransition>\r\n  );\r\n}\r\n\r\nexport default withRouter(Timeline)","import React from 'react';\r\nimport './bubbles.css'\r\n\r\nclass Circle {\r\n\r\n  constructor(color, radius) {\r\n    this.color = color;\r\n    this.radius = radius;\r\n    this.fixedX = \"left\";\r\n    this.fixedY = \"top\";\r\n    this.scale = 1;\r\n    this.isWiggling = true;\r\n  }\r\n\r\n  setOriginalPosition(x, y) {\r\n    // Origin coordinates should be set as pixels\r\n    // These coordinates will be intreprested through the lens of where this\r\n    // object is fixed.\r\n    this.origin = { x, y };\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n\r\n  calculateRelativePosition(ctx) {\r\n    // This will return the calculated position of this object within the\r\n    // given canvas context based on where this object is fixed.\r\n    const height = ctx.canvas.height;\r\n    const width = ctx.canvas.width;\r\n    const pos = {\r\n      x: this.x,\r\n      y: this.y\r\n    };\r\n\r\n    if (this.fixedX === \"right\") {\r\n      pos.x += width;\r\n    }\r\n\r\n    if (this.fixedY === \"bottom\") {\r\n      pos.y += height;\r\n    }\r\n\r\n    return pos;\r\n  }\r\n\r\n  calculateRadius() {\r\n    return this.radius * this.scale;\r\n  }\r\n\r\n}\r\nexport default class Bubbles extends React.Component {\r\n\r\n  resizeHandler = () => {\r\n    this.resizeCanvas(this.ctx);\r\n    this.step(this.circles, this.ctx);\r\n  }\r\n\r\n  componentDidMount() {\r\n    const desktopData = [\r\n      { size: 20, fx: \"left\", x: 250, fy: \"top\", y: 240, color: \"rgba(51, 145, 148, .5)\" },\r\n      { size: 70, fx: \"left\", x: 200, fy: \"top\", y: 120, color: \"rgba(30, 129, 127, .5)\" },\r\n      // { size: 130, fx: \"left\", x: 700, fy: \"top\", y: 40, color: \"rgba(167, 2, 103, .5)\" },\r\n      { size: 50, fx: \"left\", x: 370, fy: \"top\", y: 170, color: \"rgba(246, 216, 107, .5)\" },\r\n      // { size: 90, fx: \"left\", x: -15, fy: \"top\", y: 170, color: \"rgba(192, 231, 109, .5)\" },\r\n      { size: 10, fx: \"left\", x: 250, fy: \"top\", y: 270, color: \"rgba(251, 107, 65, .5)\" },\r\n      // { size: 230, fx: \"left\", x: 620, fy: \"bottom\", y: -200, color: \"rgba(241, 12, 73, .5)\" },\r\n      // { size: 230, fx: \"left\", x: 620, fy: \"bottom\", y: -200, color: \"rgba(241, 12, 73, .5)\" },\r\n      { size: 180, fx: \"left\", x: 500, fy: \"bottom\", y: -340, color: \"rgba(42, 148, 132, .5)\" },\r\n      // { size: 160, fx: \"left\", x: 760, fy: \"bottom\", y: -18, color: \"rgba(246, 216, 107, .5)\" },\r\n      { size: 110, fx: \"left\", x: 830, fy: \"bottom\", y: -320, color: \"rgba(251, 107, 65, .5)\" },\r\n      // { size: 50, fx: \"left\", x: 980, fy: \"bottom\", y: -50, color: \"rgba(192, 231, 109, .5)\" },\r\n      { size: 15, fx: \"left\", x: 540, fy: \"bottom\", y: -620, color: \"rgba(251, 107, 65, .5)\" },\r\n      { size: 65, fx: \"right\", x: -230, fy: \"top\", y: 240, color: \"rgba(167, 2, 103, .5)\" },\r\n      { size: 60, fx: \"right\", x: -100, fy: \"top\", y: 180, color: \"rgba(192, 231, 109, .5)\" },\r\n      { size: 50, fx: \"right\", x: -140, fy: \"top\", y: 400, color: \"rgba(241, 12, 73, .5)\" },\r\n      { size: 135, fx: \"right\", x: -430, fy: \"bottom\", y: -440, color: \"rgba(241, 12, 73, .5)\" },\r\n      { size: 50, fx: \"right\", x: -200, fy: \"bottom\", y: -100, color: \"rgba(251, 107, 65, .5)\" },\r\n      { size: 140, fx: \"right\", x: -40, fy: \"bottom\", y: -20, color: \"rgba(246, 216, 107, .5)\" }\r\n    ];\r\n    const ctx = this.ctx = this.instantiateCanvas();\r\n    let circles = this.circles = [];\r\n    // circles = this.instantiateCircles(mobileData);\r\n    circles = this.instantiateCircles(desktopData);\r\n    this.resizeCanvas(ctx);\r\n    this.step(circles, ctx);\r\n\r\n    window.addEventListener(\"resize\", this.resizeHandler);\r\n    window.TweenLite.ticker.addEventListener(\"tick\", () => { this.draw(circles, ctx); });\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener(\"resize\", this.resizeHandler);\r\n  }\r\n\r\n  instantiateCanvas() {\r\n    const ctx = document.getElementById(\"canvas\").getContext(\"2d\");\r\n    ctx.globalCompositeOperation = \"destination-over\";\r\n    return ctx;\r\n  }\r\n\r\n  instantiateCircles(data) {\r\n    const circles = [];\r\n\r\n    // Instantiate circles\r\n    for (let i = 0; i < data.length; i++) {\r\n      const newCircle = new Circle();\r\n      newCircle.color = data[i].color;\r\n      newCircle.radius = data[i].size;\r\n      newCircle.fixedX = data[i].fx;\r\n      newCircle.fixedY = data[i].fy;\r\n      newCircle.scale = 1.0;\r\n      newCircle.setOriginalPosition(data[i].x, data[i].y);\r\n\r\n      circles.push(newCircle);\r\n    }\r\n\r\n    return circles;\r\n  }\r\n\r\n  step(circles, ctx) {\r\n    // Wiggle circles\r\n    for (const i in circles) {\r\n      this.wiggleCircle(circles[i], ctx);\r\n    }\r\n  }\r\n\r\n  wiggleCircle(circle) {\r\n    if (circle.isWiggling) {\r\n\r\n      const tweenProperties = [\r\n        {\r\n          name: \"scale\",\r\n          min: 0.93,\r\n          max: 1\r\n        }, {\r\n          name: \"x\",\r\n          min: circle.x - 400,\r\n          max: circle.x + 400\r\n        }, {\r\n          name: \"y\",\r\n          min: circle.y - 400,\r\n          max: circle.y + 400\r\n        }];\r\n\r\n      this.wiggleProperties(circle, tweenProperties);\r\n    }\r\n  }\r\n\r\n  wiggleProperties(obj, properties) {\r\n    const duration = Math.random() * 10 + 1.5;\r\n    const tweenOptions = {\r\n      ease: window.Power1.easeInOut,\r\n      onComplete: () => { this.wiggleProperties(obj, properties); }\r\n    };\r\n\r\n    for (const i in properties) {\r\n      const property = properties[i];\r\n      tweenOptions[property.name] = Math.random() * (property.max - property.min) + property.min;\r\n    }\r\n\r\n    window.TweenLite.to(obj, duration, tweenOptions);\r\n  }\r\n\r\n  draw(circles, ctx) {\r\n    const canvasEl = ctx.canvas;\r\n\r\n    // Clear canvas\r\n    ctx.clearRect(0, 0, canvasEl.clientWidth, canvasEl.clientHeight);\r\n\r\n    // Draw circles\r\n    for (const i in circles) {\r\n      this.drawCircle(circles[i], ctx);\r\n    }\r\n  }\r\n\r\n  drawCircle(circle, ctx) {\r\n    const rad = circle.calculateRadius();\r\n    const pos = circle.calculateRelativePosition(ctx);\r\n\r\n    ctx.beginPath();\r\n    ctx.arc(pos.x, pos.y, rad, 0, 2 * Math.PI, false);\r\n    ctx.fillStyle = circle.color;\r\n    ctx.fill();\r\n  }\r\n\r\n  resizeCanvas(ctx) {\r\n    const containerEl = document.getElementById(\"canvas__container\");\r\n\r\n    ctx.canvas.height = containerEl.clientHeight;\r\n    ctx.canvas.width = containerEl.clientWidth;\r\n  }\r\n  render() {\r\n    return (\r\n      <div id=\"canvas__container\" >\r\n        <canvas id=\"canvas\" className=\"canvas\"></canvas>\r\n      </div>\r\n    )\r\n  }\r\n}","import React, { useRef, useState, useCallback, useEffect } from 'react';\r\nimport './header.css'\r\nimport Tag from '../../posts/Tag'\r\n\r\nexport default function Header(props) {\r\n  const [showAbout, setShowAbout] = useState(false)\r\n  const [close, setClose] = useState(false)\r\n  useEffect(() => {\r\n    const showed = localStorage.getItem('showedAbout');\r\n    if (!showed) {\r\n      localStorage.setItem('showedAbout', true);\r\n      setShowAbout(true);\r\n    }\r\n  }, [])\r\n  const disableScroll = useCallback(e => e.preventDefault(), []);\r\n  const toggleAbout = (e) => {\r\n    if (showAbout) {\r\n      if (e.target.classList.contains('modal-background')) {\r\n        setClose(true);\r\n        setTimeout(() => {\r\n          document.body.removeEventListener('wheel', disableScroll);\r\n          setShowAbout(!showAbout)\r\n          setClose(false);\r\n        }, 450);\r\n      }\r\n    } else {\r\n      setShowAbout(!showAbout)\r\n      document.body.addEventListener('wheel', disableScroll, { passive: false });\r\n    }\r\n  }\r\n  return (\r\n    <div className=\"header\">\r\n      <div className=\"about\" onClick={toggleAbout}>关于</div>\r\n      <div className={`modal-background ${showAbout ? 'show' : ''} ${close ? 'close' : ''}`} onClick={toggleAbout}>\r\n        <div className={`modal ${close ? 'close' : ''}`}>\r\n          <h3>网站声明</h3>\r\n          <p>这个网站主要是记录我阅读React代码的一些心得，以及介绍我开发的两款Chrome插件。</p>\r\n          <p>在讲述React代码相关的文章中，你经常会碰到这两种标记：<span className=\"tag\">标记一</span> 和 <code>标记二</code>。</p>\r\n          <p><span className=\"tag\">标记一</span> 是一个高亮的超链接，点击会跳转到链接指向的React源码地址，比如<Tag link=\"https://github.com/facebook/react/blob/a8cabb5648a14ef55cb96d679a526e3f731e9611/packages/scheduler/src/forks/Scheduler.js\">Scheduler</Tag>。<code>标记二</code> 则是我认为比较重要的、希望引起读者关注的一些关键词，如<code>Priority Queue</code>。另外，博客文章左上角的红色按钮是用于返回首页的。</p>\r\n          <p>文章中若有什么写的不好的地方欢迎指出，联系方式：<span style={{ color: 'green', fontWeight: 'bold' }}>939774876@qq.com</span></p>\r\n        </div>\r\n      </div>\r\n      <h1>🌺🍵🎅🎃Blog Share🎨🎩🎱🎵</h1>\r\n      <div className=\"meta\">\r\n        <span className=\"author\"></span><br />\r\n        By<span>&nbsp;FrankCai</span>\r\n      </div>\r\n    </div>\r\n  )\r\n}","/* 这是是加了transition-group特效的，先注释掉\r\nimport React, { Component } from 'react';\r\nimport './index.css';\r\nimport { CSSTransition } from 'react-transition-group';\r\n\r\nexport default className Post extends Component {\r\n  ref: HTMLElement | null = null;\r\n  state = {\r\n    in: false\r\n  }\r\n  componentDidMount() {\r\n    this.setState({\r\n      in: true\r\n    })\r\n  }\r\n  componentWillUnmount() {\r\n    this.setState({\r\n      in: false\r\n    })\r\n  }\r\n  render() {\r\n    return (\r\n      <>\r\n        <CSSTransition classNames=\"slide\" timeout={1300} in={this.state.in} unmountOnExit>\r\n          <div>\r\n            这是一篇博文\r\n          </div>\r\n        </CSSTransition>\r\n        <button onClick={() => this.setState({ in: !this.state.in })}>Toggle</button>\r\n      </>\r\n    )\r\n  }\r\n}\r\n*/\r\n\r\nimport React from 'react';\r\nimport './index.css'\r\nimport { Link } from 'react-router-dom';\r\nexport default class Post extends React.Component {\r\n  render() {\r\n    return <div className=\"post_header\">\r\n      <h1>这是标题</h1>\r\n      <div className=\"post_meta\">\r\n        <span className=\"post_author\"></span><br />\r\n        By <a href=\"https://twitter.com/nodws\" target=\"_b\">James Nodws</a> on May 30, 2019\r\n      </div>\r\n    </div>\r\n  }\r\n}","// import logo from './logo.svg';\nimport './App.css';\n// import Card from './components/Card';\nimport Timeline from './components/Timeline';\nimport Bubbles from './components/Background/Bubbles';\nimport Header from './components/Header/Header'\nimport { BrowserRouter as Router, Route, Switch } from 'react-router-dom'\nimport Post from './components/Post';\nimport { useEffect, useState } from 'react';\n// import PageTransition from './components/PageTransition/PageTransition';\n\nfunction App() {\n  return (\n    // <PageTransition>\n    <Router>\n      <Switch>\n        <Route exact path=\"/\">\n          <Bubbles />\n          <Header />\n          <Timeline />\n        </Route>\n        <Route exact path=\"/post\">\n          <Post />\n        </Route>\n      </Switch>\n    </Router>\n    // </PageTransition>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}