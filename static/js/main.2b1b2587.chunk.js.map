{"version":3,"sources":["posts/captures/fiber_structure.png","posts/captures/fiber_relationship.jpeg","posts/useRestTop.jsx","posts/Tag.jsx","posts/captures/createUpdate.png","posts/captures/Partial_Lanes.png","posts/index.js","posts/Post1.jsx","posts/captures/workInProgress.png","posts/Post2.jsx","posts/captures/LaneType.png","assets/images/cd-icon-location.svg","assets/images/cd-icon-movie.svg","assets/images/cd-icon-picture.svg","components/Timeline/PostItem.jsx","components/Timeline/index.jsx","components/Background/Bubbles.jsx","components/Header/Header.jsx","components/Post/index.jsx","App.js","reportWebVitals.js","index.js"],"names":["useResetTop","useEffect","window","scrollTo","Tag","jumpTo","open","props","link","onClick","this","className","children","React","Component","Post1","src","fiberSturcture","fiberRelationship","alt","Post2","imgCreateUpdate","style","display","Lanes","textIndent","picLoop","IconPicture","IconLocation","IconMovie","picClassNameLoop","PostItem","setPost","post","index","animated","useRef","useInView","threshold","ref","inView","entry","current","title","desc","date","timeLineScrollTop","postInfo","withRouter","useState","PostComponent","postMap","refCallback","useCallback","sessionStorage","getItem","setItem","setTimeout","classList","add","useLayoutEffect","scrollY","SwitchTransition","CSSTransition","classNames","timeout","id","map","toString","height","Circle","color","radius","fixedX","fixedY","scale","isWiggling","x","y","origin","ctx","canvas","width","pos","Bubbles","resizeHandler","resizeCanvas","step","circles","instantiateCanvas","instantiateCircles","size","fx","fy","addEventListener","TweenLite","ticker","draw","removeEventListener","document","getElementById","getContext","globalCompositeOperation","data","i","length","newCircle","setOriginalPosition","push","wiggleCircle","circle","tweenProperties","name","min","max","wiggleProperties","obj","properties","duration","Math","random","tweenOptions","ease","Power1","easeInOut","onComplete","property","to","canvasEl","clearRect","clientWidth","clientHeight","drawCircle","rad","calculateRadius","calculateRelativePosition","beginPath","arc","PI","fillStyle","fill","containerEl","Header","Post","href","target","App","exact","path","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode"],"mappings":"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","file":"static/js/main.2b1b2587.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/fiber_structure.2aa908cc.png\";","export default __webpack_public_path__ + \"static/media/fiber_relationship.d6d3cf53.jpeg\";","import { useEffect } from 'react';\r\nexport default function useResetTop() {\r\n  useEffect(() => {\r\n    window.scrollTo(0, 0);\r\n  }, [])\r\n}","import React from 'react';\r\nimport './tag.css';\r\n\r\nexport default class Tag extends React.Component {\r\n  jumpTo = () => {\r\n    window.open(this.props.link);\r\n  }\r\n  render() {\r\n    return <span onClick={this.jumpTo} className=\"tag\">{this.props.children}</span>\r\n  }\r\n}","export default __webpack_public_path__ + \"static/media/createUpdate.8191335a.png\";","export default __webpack_public_path__ + \"static/media/Partial_Lanes.6e03d3d0.png\";","import Post1 from \"./Post1\";\r\nimport Post2 from \"./Post2\";\r\nexport default {\r\n  Post1,\r\n  Post2\r\n}","import React from 'react';\r\nimport fiberSturcture from './captures/fiber_structure.png'\r\nimport fiberRelationship from './captures/fiber_relationship.jpeg'\r\nimport workInProgress from './captures/workInProgress.png'\r\nimport useResetTop from './useRestTop';\r\nexport default function Post1() {\r\n  useResetTop();\r\n  return (\r\n    <>\r\n      <h1>React Fiber</h1>\r\n      <p>大家以前是否有听过fiber这种数据结构呢？它是于React16之后引入的，引入的主要原因就是为了解决增量更新的问题（Incremental Rendering）。</p>\r\n      <p>在React16以前，React用到的Reconciler（协调器）叫Stack Reconciler。它主要的特征是协调过程如同函数的调用堆栈一般，过程是同步的，无法中断。</p>\r\n      <p>你是否有疑惑：无法中断就无法中断呗，有什么大问题吗？</p>\r\n      <p>这是因为，在一个页面，浏览器只会分配一个主线程来处理包含js代码的执行、样式布局、事件响应及垃圾回收等在内的任务。如果一个任务的执行时间过长，其它任务的正常运行势必会受到影响。React的reconciliation过程并不算快，尤其当页面遇到比较大的更新时，协调会耗费比较多的时间。在这期间，用户无法与页面进行交互（因为主线程忙），整个页面卡住了，用户体验急剧下降。</p>\r\n      <p>为了解决这个问题，React引入了一种叫作Fiber的数据结构 以及 增量更新的概念。</p>\r\n      <p>什么是增量更新？它指的是React的协调过程变成异步的了。它可以被打断，并且在打断后还能再恢复，在原先工作的基础上继续进行（增量更新因此得名）。这样，React的协调不会阻塞浏览器对其它事件的处理，如响应用户事件、更新动画等等。在用户看来，页面并没有卡顿，还是高响应度的，用户体验得到了极大的提高！</p>\r\n      <p>有人可能会问了：“既然增量更新这么好，为什么以前不弄呢？”这是因为之前的Stack Reconciler没有使用类似于Fiber的数据结构。它没有把大的工作（Reconciliation）拆分成以Fiber为单位的一个个小的工作单元（UnitOfWork），也没有记录当前协调所处位置的机制，因此它不可能实现增量更新。</p>\r\n      <hr />\r\n      <p>好了，说了这么多，进入我们今天的正题，好好看下fiber长什么样吧</p>\r\n      <p>首先是Fiber的数据结构：</p>\r\n      <img src={fiberSturcture} />\r\n      <p>可以看到，fiber本质上是一个JavaScript对象，它涵盖了很多信息，包括Instance，也包括Effects。我们今天重点关注和Fiber树相关的四个属性——return、child、sibling和index</p>\r\n      <p>在React15及之前的版本，reconciliation会生成VirtualDOM树；在16之后，除了生成VirtualDOM树，还会生成Fiber树。VirtualDOM树和Fiber树的层级关系是差不多的，但还是有一些细微差别的，不能完全等同。另外，Fiber上还携带了fiber需要完成的工作信息（如更新DOM，移除Ref，调用回调函数等，这些记录在Effects相关字段上）。因此，Fiber在React源码中又被称作UnitOfWork（工作单元）。</p>\r\n      <p>我们继续来看Fiber的数据结构。Fiber的child指的是它的子节点，而return指的是它的父节点。如果碰到fiber有多个子节点的情况该怎么办呢？我们注意到，fiber的数据结构里并没有children，只有child。而child不能是数组，它只能指向一个特定的fiber。在这种情况下，sibling和index属性就派上用场了。假如父biber下有多个子fiber，那么父fiber会将child指向它的第一个子fiber，剩下的子fiber通过sibling属性相连——即第一个子fiber的sibling指向第二个子Fiber，第二个子Fiber的sibling指向第三个子Fiber……依此类推，最后一个子fiber的sibling值为null（代表它后面没有相邻的fiber了）。对于这些有sibling的子fiber来说，它们依靠index来判断它们在整个子级中的位置——第一个子fiber的index值为0，第二个index值为1……依此类推。</p>\r\n      <p>讲到这里，你应该对Fiber树的结构有一个比较清晰的认识了吧，以下是我从其它地方摘来的图片供大家参考：</p>\r\n      <img src={fiberRelationship} alt=\"\" />\r\n      <p>那为什么引入了Fiber后，协调的过程就是可中断再恢复的呢？首先，React的协调是有规律的，它采用的是深度优先算法，从根（HostRoot）出发，顺着child指针一路向下，找到最左边(index等于0)、最深层(child等于null)的那个fiber，计算出它待处理的Effects。然后看这个fiber有没有兄弟元素(sibling)，有的话将指针移到这个兄弟元素。再看这个兄弟元素有没有子元素，有的话我们也是顺着child指针一路向下，找到它最左边、最深层的那个子fiber，计算出该fiber待执行的Effects……一直重复这个过程。&emsp;当fiber没有兄弟元素(sibling为null)时，我们知道我们已经遍历完了这一层的所有子fiber，需要返回上一级了，这时我们就可以通过fiber的return属性找到上一级的那个fiber了。找到后首先我们计算出这个fiber所需要执行的Effects，然后把指针移向它的兄弟元素，再重复以上操作（找最左边、最深层的子Fiber）……这样一顿操作下来，我们就会回到当初的原点(HostRoot）了，整个协调过程完成。</p>\r\n      <p>协调对象如果是一颗比较大的Fiber树的话就会比较费时，因此我们需要一种机制来记录当前工作的进度，这样我们中断后再回来还能继续在之前中断的地方工作。为此，React定义了一个模块级别的变量：workInProgress。它的取值是null或Fiber。</p>\r\n      <img src={workInProgress} alt=\"\" />\r\n      <p>我们当前协调到哪个Fiber，只需要把这个Fiber的引用赋值给模块变量workInProgress就好了。这样当协调被中断、再回来继续工作时，只需要从workInProgress引用的那个Fiber出发，按深度优先算法一级级遍历即可，毋须担心工作进度的丢失，实现了协调的异步化。</p>\r\n    </>\r\n  )\r\n}","export default \"data:image/png;base64,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\"","import React from 'react';\r\nimport Tag from './Tag';\r\nimport imgCreateUpdate from './captures/createUpdate.png'\r\nimport TypeLane from './captures/LaneType.png'\r\nimport Lanes from './captures/Partial_Lanes.png'\r\nimport useResetTop from './useRestTop';\r\nexport default function Post2() {\r\n  useResetTop();\r\n  return <>\r\n    <h1>React Fiber Lane</h1>\r\n    <p>React Fiber Lane 是React于 2020年 引入的，它最早的 PR 可以追溯回这一条：<Tag link=\"https://github.com/facebook/react/pull/18796\">Initial Lanes implementation</Tag></p>\r\n    <p>Lane 英文翻译为小巷和车道，但它在React中有另外特殊的意义 —— 具体特殊在哪呢？下面我们来一探究竟！</p>\r\n    <p>首先我们得从 lane 的前身 <Tag link=\"https://github.com/facebook/react/pull/10426\">expirationTime</Tag> 说起。expirationTime的意思是过期时间，是Update上的一个属性。当用户触发了一个更新（setState、 replaceState或forceUpdate等），React就会创建一个Update对象，并将 expirationTime 值赋给它：</p>\r\n    <img src={imgCreateUpdate} alt=\"\" />\r\n    <p>那么Update的expirationTime的值由谁决定的呢？它是由优先级决定的——优先级高的，它的过期时间自然短；而优先级低的，过期时间就会被延长。具体逻辑请参考 <Tag link=\"https://github.com/facebook/react/blob/3019210df2b486416ed94d7b9becffaf254e81c4/src/renderers/shared/fiber/ReactFiberExpirationTime.js#L61-L95\">priorityToExpirationTime</Tag>。</p>\r\n    <p>ExpirationTime机制的引入不仅能为不同级别的Update定义对应的优先级，还能防止低优先级更新一直被高优先级更新阻塞产生starvation（这是因为随着时间的推进，低优先级的expirationTime会离当前时间越来越近，这样它的优先级会随之提高，从而避免了一直被阻塞）。</p>\r\n    <p>这个模型看起来没什么问题，直到Suspense组件的出现。Suspense的作用是懒加载，它允许其内部定义的组件发送IO请求，等IO请求结束后再将组件渲染到屏幕上。Suspense的引入带来了一个新的概念，即 IO-bound，也就是说组件的更新和 IO 相关。在Suspense以前，其他更新都属于 CPU-bound（和CPU相关）。</p>\r\n    <p>在Suspense出现以前，React处理更新的模型是这样的：“低优先级的更新要想完成，必须同时把高优先级带上”。这句话是什么意思呢？官方给出了一个例子方便理解：假定有A、B、C三个更新，它们的优先级顺序是A>B>C，那么你想完成B更新就必须同时把A更新带上，你想完成C更新就必须同时把A和B都带上。</p>\r\n    <p>但是当Suspense出现以后，更新就不完全是CPU-bound了，它还可以是IO-bound。假定有以下场景：同时存在一个高级别的IO-bound更新和一个低级别CPU-bound更新，如果我们想要完成这个低级别的CPU-bound更新，就必须同时把高级别的IO-bound更新也带上。但IO与CPU的处理时间不是一个级别的，IO可能要好几秒，而CPU几毫秒就能完成了。按照之前的模型，让低级别的CPU-bound更新一直去等待高级别的IO-bound更新显然是不合理的，它造成了资源的大量浪费。于是React提出了一个新的模型：React Fiber Lane。</p>\r\n    <p>Lane是一个什么样的东西呢？首先，在JavaScript中，Lane是一个数字。更具体地说，Lane是一个4字节、32位的数字：</p>\r\n    <img src={TypeLane} alt=\"\" />\r\n    <p>React用这32位数字的不同组合来表示不同的优先级，以下对Lane定义的源码做一个节选：<span style={{ display: 'none' }}><Tag link=\"https://github.com/facebook/react/blob/a8cabb5648a14ef55cb96d679a526e3f731e9611/packages/react-reconciler/src/ReactFiberLane.new.js#L31-L79\">源码</Tag></span></p>\r\n    <img src={Lanes} alt=\"\" />\r\n    <p>可以看到，大部分Lane的定义都是以 0b 开头，加上一串0、1序列的数字（0b代表二进制）。每个序列里一般只有一个1，其余都是0。最右边的1代表最高优先级，最左边的1代表最低优先级，如SyncLane：0b0000000000000000000000000000001（最高优先级）和OffscreenLane：0b1000000000000000000000000000000（最低优先级）。</p>\r\n    <p>我们来看一下Lane模型比expirationTime模型好在哪。1. Lane只占4个字节，但它却可以表示至多31种优先级别，说明它在空间上很占优势（内存）。2. Lane的操作非常快，它的所有操作都是基于位的，不需要做额外的转换。这说明它在时间上也占优势（CPU）。这里我们简单地展示下常见的几种位操作，方便大家对它的理解：</p>\r\n    <p>1. 判断某一位上是否为1：<br /><span style={{ textIndent: '2em', display: 'inline-block' }}>假定有一个4字节的数字，我们想知道它从右往左数第3位数字是否为1，只需要将该数字与0b100做一次<code>&</code>运算，若结果不为0，则说明该数字从右往左数第3位为1： <code>test_number & 0b100 !== 0</code></span></p>\r\n    <p>2. 计算两个数字所有位为1的并集：<br /><span style={{ textIndent: '2em', display: 'inline-block' }}>假定有两个数字，我们想知道当它们用二进制表示时，所有值等于1的位进行合并，会产生出一个什么样的新数字，那我们可以对这两个数字进行一个<code>|</code>运算，比如： <code>0b100 | 0b101 === 0b101</code></span></p>\r\n    <p>3. 拿到数字最右边值为1的那一位所代表的数的大小：<br /><span style={{ textIndent: '2em', display: 'inline-block' }}>比如有个数字 0b1100，我们想知道它最右边的那个1代表的数值大小（0b1100最右边的1的大小为4），我们可以对它自身与其相反数进行一次<code>~</code>操作，具体是： <code>lane ~ -lane</code>，这样我们就拿到最右边那位1所代表的值大小了。不信你试一下！</span></p>\r\n    <p>………………（位的常规操作还有很多，这里不一一列举了）</p>\r\n    <p>总的来说，这篇文章的主题是Lane作为expirationTime的替代品出现在React中的。它们虽然都被用来表示优先级，但Lane解耦了两个被expirationTime混淆的概念：1. 权限大小(priority) 2. 批次(batch)。 在Lane模型中，权限大的更新可以和权限小的更新分批次去执行（通过给它们分配不同的Lane），但expirationTime会把权限大小与批次捆绑在一起。另外，Lane无论是在时间（位操作）还是空间（4字节）上都更具优势，因此 Lane 取代了 expirationTime！！<span style={{ display: 'none' }}>因为权限大的可能是IO-bound，而权限小的可能是CPU-bound。</span><span style={{ display: 'none' }}>在原先的expirationTime模型，权限大的一定要比权限小的先执行，或者说权限小的想要执行，必须同时完成权限大的。expirationTime把这两个概念混在了一起。但这种模式到了Suspense就不起作用了，因为有可能出现权限高的IO-bound更新和权限低的CPU-bound更新，这种情况下我们不应该把它们放在同一批次，也就是说即使权限大的不应阻塞权限小的。是需要分批(unbatch）去处理这两个更新的，不能把它们放在一起。</span></p>\r\n  </>\r\n}","export default \"data:image/png;base64,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\"","export default __webpack_public_path__ + \"static/media/cd-icon-location.3df4df56.svg\";","export default __webpack_public_path__ + \"static/media/cd-icon-movie.cd657a03.svg\";","export default __webpack_public_path__ + \"static/media/cd-icon-picture.cf28d9b1.svg\";","import React, { useEffect, useRef } from 'react';\r\nimport IconLocation from '../../assets/images/cd-icon-location.svg';\r\nimport IconMovie from '../../assets/images/cd-icon-movie.svg';\r\nimport IconPicture from '../../assets/images/cd-icon-picture.svg';\r\n\r\nimport { useInView } from 'react-intersection-observer';\r\n\r\nconst picLoop = [IconPicture, IconLocation, IconMovie];\r\nconst picClassNameLoop = ['cd-picture', 'cd-movie', 'cd-location'];\r\n\r\nexport default function PostItem(props) {\r\n  const { setPost, post, index } = props;\r\n  const animated = useRef(false);\r\n  const { ref, inView, entry } = useInView({\r\n    threshold: 0.2,\r\n  });\r\n  useEffect(() => {\r\n    if (inView == true && animated.current == false) {\r\n      animated.current = true;\r\n    }\r\n  }, [inView])\r\n  return (\r\n    <div className='cd-timeline-block' ref={ref} data-inview={inView}>\r\n      <div className={`cd-timeline-img ${picClassNameLoop[index % 3]} ${animated.current ? '' : inView ? 'bounce-in' : 'is-hidden'}`}>\r\n        <img src={picLoop[index % 3]} alt='Picture' />\r\n      </div>\r\n      <div className={`cd-timeline-content ${animated.current ? '' : inView ? 'bounce-in' : 'is-hidden'}`} onClick={() => setPost(`Post${index + 1}`)}>\r\n        <h2>{post.title}</h2>\r\n        <p>\r\n          {post.desc}\r\n        </p>\r\n        <span className='cd-read-more'>\r\n          阅读更多\r\n        </span>\r\n        <span className='cd-date'>{post.date}</span>\r\n      </div>\r\n    </div>\r\n  )\r\n}","import React, { useCallback, useEffect, useLayoutEffect, useState } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport { BrowserRouter as Router, Link, Route } from 'react-router-dom';\r\n// import Post from '../Post';\r\nimport { withRouter } from \"react-router\";\r\nimport postMap from '../../posts'\r\nimport { CSSTransition, TransitionGroup, SwitchTransition } from 'react-transition-group';\r\nimport PostItem from './PostItem';\r\n\r\nlet timeLineScrollTop = 0;\r\n\r\nconst postInfo = [\r\n  {\r\n    title: 'React Fiber',\r\n    desc: '这篇文章会为我们解密React Fiber是什么以及Fiber解决了什么问题',\r\n    date: 'Jan 14'\r\n  },\r\n  {\r\n    title: 'React Fiber Lane',\r\n    desc: 'React Fiber Lane是React新引入的优先级机制，它解决了expirationTime模型的一些痛点！具体是什么呢？这篇文章将为我们揭开其神秘面纱',\r\n    date: 'Jan 19'\r\n  },\r\n  {\r\n    title: 'fake title',\r\n    desc: 'fake desc',\r\n    date: 'Feb 17'\r\n  },\r\n  {\r\n    title: 'fake title',\r\n    desc: 'fake desc',\r\n    date: 'Feb 28'\r\n  },\r\n  {\r\n    title: 'fake title',\r\n    desc: 'fake desc',\r\n    date: 'May 5'\r\n  },\r\n  {\r\n    title: 'fake title',\r\n    desc: 'fake desc',\r\n    date: 'Jun 6'\r\n  },\r\n]\r\n\r\nfunction Timeline(props) {\r\n  const [post, setPost] = useState(null);\r\n  const PostComponent = postMap[post];\r\n  const refCallback = useCallback((ref) => {\r\n    if (ref) {\r\n      const reminded = sessionStorage.getItem('reminded');\r\n      if (!reminded) {\r\n        sessionStorage.setItem('reminded', true);\r\n        setTimeout(() => {\r\n          ref.classList.add('jump')\r\n        }, 400)\r\n      }\r\n    }\r\n  }, [])\r\n  useLayoutEffect(() => {\r\n    if (post) {\r\n      timeLineScrollTop = window.scrollY;\r\n    } else {\r\n      window.scrollTo(0, timeLineScrollTop);\r\n    }\r\n  }, [post])\r\n  return (\r\n    <SwitchTransition>\r\n      <CSSTransition classNames=\"slide\" timeout={400} key={post}>\r\n        {post === null ? <section id='cd-timeline' className='cd-container'>\r\n          {postInfo.map((post, index) => (\r\n            <PostItem post={post} index={index} setPost={setPost} key={index.toString()} />\r\n          ))}\r\n        </section>\r\n          : <div>\r\n            <div id=\"post_container\">\r\n              <div className=\"window_header\">\r\n                {/* <div class=\"circle\" /> */}\r\n                <span className=\"circle circle1\" ref={refCallback} title=\"返回\" onClick={() => setPost(null)} />\r\n                <span className=\"circle circle2\" />\r\n                <span className=\"circle circle3\" />\r\n              </div>\r\n              <div className=\"post_content\">\r\n                <PostComponent />\r\n              </div>\r\n            </div>\r\n            <div style={{ height: '130px' }}></div>\r\n          </div>}\r\n      </CSSTransition>\r\n    </SwitchTransition>\r\n  );\r\n}\r\n\r\nexport default withRouter(Timeline)","import React from 'react';\r\nimport './bubbles.css'\r\n\r\nclass Circle {\r\n\r\n  constructor(color, radius) {\r\n    this.color = color;\r\n    this.radius = radius;\r\n    this.fixedX = \"left\";\r\n    this.fixedY = \"top\";\r\n    this.scale = 1;\r\n    this.isWiggling = true;\r\n  }\r\n\r\n  setOriginalPosition(x, y) {\r\n    // Origin coordinates should be set as pixels\r\n    // These coordinates will be intreprested through the lens of where this\r\n    // object is fixed.\r\n    this.origin = { x, y };\r\n    this.x = x;\r\n    this.y = y;\r\n  }\r\n\r\n  calculateRelativePosition(ctx) {\r\n    // This will return the calculated position of this object within the\r\n    // given canvas context based on where this object is fixed.\r\n    const height = ctx.canvas.height;\r\n    const width = ctx.canvas.width;\r\n    const pos = {\r\n      x: this.x,\r\n      y: this.y\r\n    };\r\n\r\n    if (this.fixedX === \"right\") {\r\n      pos.x += width;\r\n    }\r\n\r\n    if (this.fixedY === \"bottom\") {\r\n      pos.y += height;\r\n    }\r\n\r\n    return pos;\r\n  }\r\n\r\n  calculateRadius() {\r\n    return this.radius * this.scale;\r\n  }\r\n\r\n}\r\nexport default class Bubbles extends React.Component {\r\n\r\n  resizeHandler = () => {\r\n    this.resizeCanvas(this.ctx);\r\n    this.step(this.circles, this.ctx);\r\n  }\r\n\r\n  componentDidMount() {\r\n    const desktopData = [\r\n      { size: 20, fx: \"left\", x: 250, fy: \"top\", y: 240, color: \"rgba(51, 145, 148, .5)\" },\r\n      { size: 70, fx: \"left\", x: 200, fy: \"top\", y: 120, color: \"rgba(30, 129, 127, .5)\" },\r\n      // { size: 130, fx: \"left\", x: 700, fy: \"top\", y: 40, color: \"rgba(167, 2, 103, .5)\" },\r\n      { size: 50, fx: \"left\", x: 370, fy: \"top\", y: 170, color: \"rgba(246, 216, 107, .5)\" },\r\n      // { size: 90, fx: \"left\", x: -15, fy: \"top\", y: 170, color: \"rgba(192, 231, 109, .5)\" },\r\n      { size: 10, fx: \"left\", x: 250, fy: \"top\", y: 270, color: \"rgba(251, 107, 65, .5)\" },\r\n      // { size: 230, fx: \"left\", x: 620, fy: \"bottom\", y: -200, color: \"rgba(241, 12, 73, .5)\" },\r\n      // { size: 230, fx: \"left\", x: 620, fy: \"bottom\", y: -200, color: \"rgba(241, 12, 73, .5)\" },\r\n      { size: 180, fx: \"left\", x: 500, fy: \"bottom\", y: -340, color: \"rgba(42, 148, 132, .5)\" },\r\n      // { size: 160, fx: \"left\", x: 760, fy: \"bottom\", y: -18, color: \"rgba(246, 216, 107, .5)\" },\r\n      { size: 110, fx: \"left\", x: 830, fy: \"bottom\", y: -320, color: \"rgba(251, 107, 65, .5)\" },\r\n      // { size: 50, fx: \"left\", x: 980, fy: \"bottom\", y: -50, color: \"rgba(192, 231, 109, .5)\" },\r\n      { size: 15, fx: \"left\", x: 540, fy: \"bottom\", y: -620, color: \"rgba(251, 107, 65, .5)\" },\r\n      { size: 65, fx: \"right\", x: -230, fy: \"top\", y: 240, color: \"rgba(167, 2, 103, .5)\" },\r\n      { size: 60, fx: \"right\", x: -100, fy: \"top\", y: 180, color: \"rgba(192, 231, 109, .5)\" },\r\n      { size: 50, fx: \"right\", x: -140, fy: \"top\", y: 400, color: \"rgba(241, 12, 73, .5)\" },\r\n      { size: 135, fx: \"right\", x: -430, fy: \"bottom\", y: -440, color: \"rgba(241, 12, 73, .5)\" },\r\n      { size: 50, fx: \"right\", x: -200, fy: \"bottom\", y: -100, color: \"rgba(251, 107, 65, .5)\" },\r\n      { size: 140, fx: \"right\", x: -40, fy: \"bottom\", y: -20, color: \"rgba(246, 216, 107, .5)\" }\r\n    ];\r\n    const ctx = this.ctx = this.instantiateCanvas();\r\n    let circles = this.circles = [];\r\n    // circles = this.instantiateCircles(mobileData);\r\n    circles = this.instantiateCircles(desktopData);\r\n    this.resizeCanvas(ctx);\r\n    this.step(circles, ctx);\r\n\r\n    window.addEventListener(\"resize\", this.resizeHandler);\r\n    window.TweenLite.ticker.addEventListener(\"tick\", () => { this.draw(circles, ctx); });\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    window.removeEventListener(\"resize\", this.resizeHandler);\r\n  }\r\n\r\n  instantiateCanvas() {\r\n    const ctx = document.getElementById(\"canvas\").getContext(\"2d\");\r\n    ctx.globalCompositeOperation = \"destination-over\";\r\n    return ctx;\r\n  }\r\n\r\n  instantiateCircles(data) {\r\n    const circles = [];\r\n\r\n    // Instantiate circles\r\n    for (let i = 0; i < data.length; i++) {\r\n      const newCircle = new Circle();\r\n      newCircle.color = data[i].color;\r\n      newCircle.radius = data[i].size;\r\n      newCircle.fixedX = data[i].fx;\r\n      newCircle.fixedY = data[i].fy;\r\n      newCircle.scale = 1.0;\r\n      newCircle.setOriginalPosition(data[i].x, data[i].y);\r\n\r\n      circles.push(newCircle);\r\n    }\r\n\r\n    return circles;\r\n  }\r\n\r\n  step(circles, ctx) {\r\n    // Wiggle circles\r\n    for (const i in circles) {\r\n      this.wiggleCircle(circles[i], ctx);\r\n    }\r\n  }\r\n\r\n  wiggleCircle(circle) {\r\n    if (circle.isWiggling) {\r\n\r\n      const tweenProperties = [\r\n        {\r\n          name: \"scale\",\r\n          min: 0.93,\r\n          max: 1\r\n        }, {\r\n          name: \"x\",\r\n          min: circle.x - 400,\r\n          max: circle.x + 400\r\n        }, {\r\n          name: \"y\",\r\n          min: circle.y - 400,\r\n          max: circle.y + 400\r\n        }];\r\n\r\n      this.wiggleProperties(circle, tweenProperties);\r\n    }\r\n  }\r\n\r\n  wiggleProperties(obj, properties) {\r\n    const duration = Math.random() * 10 + 1.5;\r\n    const tweenOptions = {\r\n      ease: window.Power1.easeInOut,\r\n      onComplete: () => { this.wiggleProperties(obj, properties); }\r\n    };\r\n\r\n    for (const i in properties) {\r\n      const property = properties[i];\r\n      tweenOptions[property.name] = Math.random() * (property.max - property.min) + property.min;\r\n    }\r\n\r\n    window.TweenLite.to(obj, duration, tweenOptions);\r\n  }\r\n\r\n  draw(circles, ctx) {\r\n    const canvasEl = ctx.canvas;\r\n\r\n    // Clear canvas\r\n    ctx.clearRect(0, 0, canvasEl.clientWidth, canvasEl.clientHeight);\r\n\r\n    // Draw circles\r\n    for (const i in circles) {\r\n      this.drawCircle(circles[i], ctx);\r\n    }\r\n  }\r\n\r\n  drawCircle(circle, ctx) {\r\n    const rad = circle.calculateRadius();\r\n    const pos = circle.calculateRelativePosition(ctx);\r\n\r\n    ctx.beginPath();\r\n    ctx.arc(pos.x, pos.y, rad, 0, 2 * Math.PI, false);\r\n    ctx.fillStyle = circle.color;\r\n    ctx.fill();\r\n  }\r\n\r\n  resizeCanvas(ctx) {\r\n    const containerEl = document.getElementById(\"canvas__container\");\r\n\r\n    ctx.canvas.height = containerEl.clientHeight;\r\n    ctx.canvas.width = containerEl.clientWidth;\r\n  }\r\n  render() {\r\n    return (\r\n      <div id=\"canvas__container\" >\r\n        <canvas id=\"canvas\" className=\"canvas\"></canvas>\r\n      </div>\r\n    )\r\n  }\r\n}","import React from 'react';\r\nimport './header.css'\r\n\r\nexport default function Header(props) {\r\n  return (\r\n    <div className=\"header\">\r\n      <h1>🌺🍵🎅🎃Blog Share🎨🎩🎱🎵</h1>\r\n      <div className=\"meta\">\r\n        <span className=\"author\"></span><br />\r\n        By<span>&nbsp;FrankCai</span>\r\n      </div>\r\n    </div>\r\n  )\r\n}","/* 这是是加了transition-group特效的，先注释掉\r\nimport React, { Component } from 'react';\r\nimport './index.css';\r\nimport { CSSTransition } from 'react-transition-group';\r\n\r\nexport default className Post extends Component {\r\n  ref: HTMLElement | null = null;\r\n  state = {\r\n    in: false\r\n  }\r\n  componentDidMount() {\r\n    this.setState({\r\n      in: true\r\n    })\r\n  }\r\n  componentWillUnmount() {\r\n    this.setState({\r\n      in: false\r\n    })\r\n  }\r\n  render() {\r\n    return (\r\n      <>\r\n        <CSSTransition classNames=\"slide\" timeout={1300} in={this.state.in} unmountOnExit>\r\n          <div>\r\n            这是一篇博文\r\n          </div>\r\n        </CSSTransition>\r\n        <button onClick={() => this.setState({ in: !this.state.in })}>Toggle</button>\r\n      </>\r\n    )\r\n  }\r\n}\r\n*/\r\n\r\nimport React from 'react';\r\nimport './index.css'\r\nimport { Link } from 'react-router-dom';\r\nexport default class Post extends React.Component {\r\n  render() {\r\n    return <div className=\"post_header\">\r\n      <h1>这是标题</h1>\r\n      <div className=\"post_meta\">\r\n        <span className=\"post_author\"></span><br />\r\n        By <a href=\"https://twitter.com/nodws\" target=\"_b\">James Nodws</a> on May 30, 2019\r\n      </div>\r\n    </div>\r\n  }\r\n}","// import logo from './logo.svg';\nimport './App.css';\n// import Card from './components/Card';\nimport Timeline from './components/Timeline';\nimport Bubbles from './components/Background/Bubbles';\nimport Header from './components/Header/Header'\nimport { BrowserRouter as Router, Route, Switch } from 'react-router-dom'\nimport Post from './components/Post';\nimport { useEffect, useState } from 'react';\n// import PageTransition from './components/PageTransition/PageTransition';\n\nfunction App() {\n  return (\n    // <PageTransition>\n    <Router>\n      <Switch>\n        <Route exact path=\"/\">\n          <Bubbles />\n          <Header />\n          <Timeline />\n        </Route>\n        <Route exact path=\"/post\">\n          <Post />\n        </Route>\n      </Switch>\n    </Router>\n    // </PageTransition>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}